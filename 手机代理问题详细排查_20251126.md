# 🔍 手机代理问题详细排查（2025-11-26）

## ✅ 服务器端状态

- ✅ Squid 代理服务正常运行
- ✅ 端口 3128 已开放
- ✅ HTTPS 支持正常
- ✅ 服务器端测试可以访问 Google

## ❌ 手机端问题

- ❌ 仍然提示"网址无效"
- ❌ 无法访问 Google

---

## 🔍 详细排查步骤

### 步骤1：确认手机是否真的在使用代理

#### 方法A：查看代理日志

在远程桌面终端运行：

```bash
# 实时查看代理访问日志
sudo tail -f /var/log/squid/access.log
```

然后在手机上尝试访问任何网站（如 baidu.com），看日志中是否有记录。

**如果没有记录**：说明手机没有连接到代理（可能是安全组未配置，或代理配置错误）

**如果有记录但显示错误**：说明连接到了，但有问题

#### 方法B：检查手机网络信息

在 iPhone 上：
1. **设置 → Wi-Fi**
2. **点击你连接的 Wi-Fi 网络**（ⓘ 图标）
3. **查看"IP 地址"**（记下这个地址）
4. **确认"HTTP 代理"显示"手动"**

### 步骤2：确认阿里云安全组配置

**这是最可能的问题！**

1. **登录阿里云控制台**
2. **进入 ECS 实例管理**
3. **找到你的香港服务器**
4. **点击"安全组"**
5. **查看入站规则**，确认是否有 3128 端口

**如果没有 3128 端口规则**：
- 点击"添加安全组规则"
- 端口：`3128/3128`
- 协议：TCP
- 授权对象：`0.0.0.0/0`
- 保存

### 步骤3：测试基本连接

在手机上：

1. **先测试本地网站**：
   - 访问 `http://www.baidu.com`
   - 如果能打开，说明代理基本工作

2. **测试 HTTP（非 HTTPS）**：
   - 访问 `http://www.google.com`（注意是 http）
   - 看是否能访问

3. **测试 HTTPS**：
   - 访问 `https://www.google.com`
   - 如果不行，可能是 HTTPS 问题

### 步骤4：检查代理配置细节

在 iPhone 上确认：

1. **服务器地址**：
   - 应该是：`47.243.177.166`
   - **不能有空格**
   - **不能有 http:// 前缀**

2. **端口**：
   - 应该是：`3128`
   - **必须是数字**，不是文字

3. **认证**：
   - 应该是：关闭

4. **Wi-Fi 连接**：
   - 必须使用 Wi-Fi（不是数据流量）

---

## 🔧 可能的解决方案

### 方案1：重新配置代理（完全重新来）

1. **关闭代理**：
   - 设置 → Wi-Fi → 点击网络 → HTTP 代理 → 关闭
   - 保存

2. **断开 Wi-Fi**：
   - 关闭 Wi-Fi
   - 等待 10 秒

3. **重新连接并配置**：
   - 打开 Wi-Fi
   - 重新连接网络
   - 配置代理（服务器：47.243.177.166，端口：3128）
   - 保存

4. **再次断开并重连 Wi-Fi**

5. **测试访问**

### 方案2：尝试使用不同的端口

如果 3128 不行，可以尝试使用 7890（之前 Squid 使用的端口）：

1. **在服务器上**：
   ```bash
   sudo sed -i 's/http_port 3128/http_port 7890/' /etc/squid/squid.conf
   sudo systemctl restart squid
   sudo ufw allow 7890/tcp
   ```

2. **在手机上**：
   - 代理端口改为 `7890`

### 方案3：检查是否有防火墙阻止

在服务器上检查：

```bash
# 检查 UFW
sudo ufw status

# 检查 iptables（如果有）
sudo iptables -L -n | grep 3128
```

---

## 🆘 如果所有方法都不行

### 最终方案：使用 SOCKS5 代理

如果 HTTP 代理不行，可以尝试 SOCKS5：

1. **在服务器上安装 SSH**（已安装）
2. **在 Mac 上建立 SOCKS5 隧道**：
   ```bash
   ssh -D 1080 -N root@47.243.177.166
   ```
3. **Mac 开启热点**
4. **手机连接 Mac 热点**
5. **在手机上配置 SOCKS5 代理**（需要支持 SOCKS5 的应用）

但这个方法比较复杂。

---

## 📝 需要你提供的信息

为了进一步排查，请告诉我：

1. **在手机上访问 baidu.com 能否打开？**
2. **阿里云安全组是否已配置 3128 端口？**
3. **代理日志中是否有来自你手机的请求？**（运行 `sudo tail -f /var/log/squid/access.log` 查看）
4. **手机 Wi-Fi 的 IP 地址是什么？**（设置 → Wi-Fi → 点击网络 → IP 地址）

---

## 💡 临时解决方案

如果代理一直不行，建议：

1. **在远程桌面完成 Google 注册**
2. **如果必须手机验证，暂时跳过**
3. **或使用其他设备完成验证**

---

**最后更新**：2025-11-26








