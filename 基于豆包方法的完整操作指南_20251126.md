# 🎯 基于豆包方法的完整操作指南（2025-11-26）

## 📋 你的情况

- ✅ 有香港服务器（47.243.177.166）
- ✅ 有图形化桌面（远程桌面 Ubuntu）
- ✅ Mac 需要通过图形化软件访问 Google
- ✅ iPhone 需要通过 Mac/Ubuntu 中转访问 Google

---

## 🚀 方案选择

### 情况1：在 Mac 上访问 Google（推荐）

如果你在 Mac 上通过图形化软件（如 VPN/代理客户端）访问 Google：

**使用 ClashX Pro 开启局域网共享**

### 情况2：在远程桌面（Ubuntu）上访问 Google

如果你在远程桌面（Ubuntu）上访问 Google：

**使用 Clash for Linux 或 3Proxy 开启局域网共享**

---

## ✅ 方案一：Mac + ClashX Pro（推荐）

### 步骤1：在 Mac 上安装 ClashX Pro

1. **下载 ClashX Pro**：
   - 访问：https://github.com/yichengchen/clashX/releases
   - 下载最新版本（.dmg 文件）
   - 安装到 Mac

### 步骤2：配置 ClashX Pro

#### 选项A：如果你有 V2Ray/Shadowsocks 配置

1. **导入配置到 ClashX Pro**
2. **选择香港节点**
3. **测试访问 Google**

#### 选项B：使用现有的 Squid 代理

1. **打开 ClashX Pro**
2. **创建配置文件**：
   - 点击菜单栏的 ClashX Pro 图标
   - 选择"配置" → "打开配置文件夹"
   - 创建一个新文件：`hongkong.yaml`

3. **编辑配置文件**：
   ```yaml
   port: 7890
   socks-port: 7891
   allow-lan: true
   mode: rule
   log-level: info
   
   proxies:
     - name: "HongKong-Squid"
       type: http
       server: 47.243.177.166
       port: 3128
   
   proxy-groups:
     - name: "Proxy"
       type: select
       proxies:
         - "HongKong-Squid"
   
   rules:
     - MATCH,Proxy
   ```

4. **保存配置文件**
5. **在 ClashX Pro 中选择这个配置**
6. **点击"设置为系统代理"**

### 步骤3：测试 Mac 访问 Google

1. **在 Mac 上打开浏览器**
2. **访问**：`https://www.google.com`
3. **确认可以访问**

### 步骤4：开启局域网共享

1. **打开 ClashX Pro 偏好设置**：
   - 点击菜单栏的 ClashX Pro 图标
   - 选择"偏好设置"

2. **开启局域网连接**：
   - ✅ 勾选"允许局域网连接"
   - 记录 HTTP 端口（7890）
   - 记录 SOCKS5 端口（7891）

3. **查看 Mac 内网 IP**：
   ```bash
   ipconfig getifaddr en0
   ```
   - 记录这个 IP（例如：192.168.1.105）

4. **防火墙放行**（如果需要）：
   - 系统设置 → 网络 → 防火墙 → 选项
   - 允许 ClashX Pro 入站连接

### 步骤5：配置 iPhone Wi-Fi 代理

1. **打开 iPhone 设置 → Wi-Fi**
2. **点击当前连接的 Wi-Fi 网络**（点击 ⓘ 图标）
3. **向下滚动到"HTTP 代理"**
4. **选择"手动"**
5. **填写**：
   - 服务器：Mac 的内网 IP（例如：192.168.1.105）
   - 端口：7890
   - 认证：关闭（如果开启了认证，填写用户名和密码）
6. **保存并返回**

### 步骤6：测试 iPhone 访问 Google

1. **在 iPhone 上打开 Safari**
2. **访问**：`http://ipinfo.io`
3. **确认 IP 已切换**（应该显示香港 IP）
4. **访问**：`https://accounts.google.com/signup`
5. **看是否能打开**

---

## ✅ 方案二：远程桌面（Ubuntu）+ Clash for Linux

### 步骤1：在 Ubuntu 上安装 Clash

```bash
# 下载 Clash
cd /tmp
wget https://github.com/Dreamacro/clash/releases/download/v1.18.0/clash-linux-amd64-v1.18.0.gz
gunzip clash-linux-amd64-v1.18.0.gz
chmod +x clash-linux-amd64-v1.18.0
sudo mv clash-linux-amd64-v1.18.0 /usr/local/bin/clash
```

### 步骤2：配置 Clash

1. **创建配置目录**：
   ```bash
   mkdir -p ~/.config/clash
   cd ~/.config/clash
   ```

2. **创建配置文件** `config.yaml`：
   ```yaml
   port: 7890
   socks-port: 7891
   allow-lan: true
   bind-address: 0.0.0.0
   mode: rule
   log-level: info
   
   proxies:
     - name: "HongKong-Squid"
       type: http
       server: 47.243.177.166
       port: 3128
   
   proxy-groups:
     - name: "Proxy"
       type: select
       proxies:
         - "HongKong-Squid"
   
   rules:
     - MATCH,Proxy
   ```

3. **启动 Clash**：
   ```bash
   clash
   ```

### 步骤3：防火墙放行

```bash
sudo ufw allow 7890/tcp
sudo ufw allow 7891/tcp
sudo ufw reload
```

### 步骤4：查看 Ubuntu 内网 IP

```bash
ip addr show | grep "inet " | grep -v 127.0.0.1
```

记录内网 IP（例如：192.168.1.106）

### 步骤5：配置 iPhone Wi-Fi 代理

同方案一的步骤5，但使用 Ubuntu 的内网 IP。

---

## ✅ 方案三：远程桌面（Ubuntu）+ 3Proxy（极简）

### 步骤1：安装 3Proxy

```bash
sudo apt update
sudo apt install 3proxy -y
```

### 步骤2：配置 3Proxy

1. **创建配置文件** `/etc/3proxy/3proxy.cfg`：
   ```bash
   sudo nano /etc/3proxy/3proxy.cfg
   ```

2. **添加配置**：
   ```
   # 监听内网，HTTP 代理
   proxy -p3128 -a
   
   # 监听内网，SOCKS5 代理
   socks -p1080
   ```

3. **保存并退出**（Ctrl+X, Y, Enter）

### 步骤3：启动 3Proxy

```bash
sudo systemctl start 3proxy
sudo systemctl enable 3proxy
```

### 步骤4：防火墙放行

```bash
sudo ufw allow 3128/tcp
sudo ufw allow 1080/tcp
sudo ufw reload
```

### 步骤5：查看 Ubuntu 内网 IP 并配置 iPhone

同方案二的步骤4和步骤5。

---

## 🔍 常见问题解决

### 问题1：连接失败

**检查**：
- Mac/Ubuntu 内网 IP 是否正确
- 端口是否被占用
- 防火墙是否放行
- iPhone 与电脑是否在同一局域网

**解决**：
```bash
# Mac 查看 IP
ipconfig getifaddr en0

# Ubuntu 查看 IP
ip addr show

# 测试端口是否监听
netstat -an | grep 7890
```

### 问题2：仅浏览器可用，应用不可用

**原因**：iOS 原生 Wi-Fi 代理仅支持 HTTP/HTTPS

**解决**：
- 使用 iPhone 代理客户端（如 Shadowrocket）
- 配置 SOCKS5 代理（端口 7891）
- 实现全局代理

### 问题3：访问 HTTPS 提示证书错误

**解决**：
1. 在 iPhone 上安装对应根证书
2. 设置 → 通用 → 关于本机 → 证书信任设置
3. 启用完全信任

### 问题4：速度慢/卡顿

**解决**：
- 切换低延迟香港节点
- 减少同时连接设备数量
- 关闭电脑端带宽占用高的应用

---

## 🔐 安全建议

### 启用代理认证

在 ClashX Pro 或 Clash 配置中添加：

```yaml
# ClashX Pro / Clash
authentication:
  - "username:password"
```

### 限制 IP 访问

仅允许 iPhone 固定内网 IP 连接代理。

---

## 📝 操作步骤总结

### 如果选择 Mac + ClashX Pro：

1. ✅ 安装 ClashX Pro
2. ✅ 配置使用香港服务器（Squid 或 V2Ray/Shadowsocks）
3. ✅ 测试 Mac 访问 Google
4. ✅ 开启局域网共享（端口 7890）
5. ✅ iPhone 配置 Wi-Fi 代理（Mac 内网 IP + 7890）
6. ✅ 测试 iPhone 访问 Google

### 如果选择 Ubuntu + Clash：

1. ✅ 安装 Clash for Linux
2. ✅ 配置使用香港服务器
3. ✅ 开启局域网监听（0.0.0.0:7890）
4. ✅ 防火墙放行端口
5. ✅ iPhone 配置 Wi-Fi 代理（Ubuntu 内网 IP + 7890）
6. ✅ 测试 iPhone 访问 Google

---

## 🎯 推荐

1. **如果在 Mac 上访问 Google**：使用 ClashX Pro（最简单）
2. **如果在远程桌面（Ubuntu）上访问 Google**：使用 Clash for Linux 或 3Proxy

---

**最后更新**：2025-11-26  
**推荐**：根据你的实际情况选择方案








