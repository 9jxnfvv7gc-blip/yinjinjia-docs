# 🔍 代理问题排查指南（2025-11-26）

## 🐛 问题：提示"网址无效"或"无互联网连接"

### 可能原因

1. **代理配置错误**
2. **Squid 服务问题**
3. **安全组未开放端口**
4. **网络连接问题**

---

## ✅ 排查步骤

### 步骤1：确认手机代理配置

在 iPhone 上检查：

1. **设置 → Wi-Fi**
2. **点击你连接的 Wi-Fi 网络**（ⓘ 图标）
3. **向下滚动到"HTTP 代理"**
4. **确认配置**：
   - 应该显示"手动"
   - 服务器：`47.243.177.166`
   - 端口：`3128`
   - 认证：关闭

### 步骤2：测试代理连接

在远程桌面终端运行：

```bash
# 查看 Squid 访问日志
sudo tail -f /var/log/squid/access.log
```

然后在手机上尝试访问任何网站，看日志中是否有记录。

### 步骤3：检查 Squid 服务

```bash
# 检查服务状态
sudo systemctl status squid

# 检查端口监听
sudo netstat -tlnp | grep 3128

# 测试本地代理
curl -x http://localhost:3128 -I https://www.google.com
```

### 步骤4：检查防火墙和安全组

```bash
# 检查 UFW
sudo ufw status | grep 3128

# 确认阿里云安全组已开放 3128 端口
```

---

## 🔧 常见问题解决

### 问题1：代理配置后无法上网

**原因**：代理可能阻止了某些连接

**解决**：
1. 临时关闭代理（设置为"关闭"）
2. 测试能否正常上网
3. 如果能上网，说明问题在代理
4. 检查 Squid 配置

### 问题2：HTTPS 网站无法访问

**原因**：Squid 需要支持 CONNECT 方法

**解决**：已配置，检查是否生效：
```bash
sudo grep -E 'CONNECT|SSL_ports' /etc/squid/squid.conf
```

### 问题3：代理连接超时

**原因**：
- 安全组未开放端口
- 防火墙阻止
- 网络问题

**解决**：
1. 检查阿里云安全组
2. 检查 UFW 防火墙
3. 测试服务器网络连接

---

## 🚀 快速测试方法

### 方法1：在 Mac 上测试代理

在 Mac 终端运行：

```bash
# 测试代理是否工作
curl -x http://47.243.177.166:3128 -I https://www.google.com
```

如果返回 HTTP 200，说明代理工作正常。

### 方法2：使用浏览器测试

在 Mac 浏览器中配置代理：
1. 系统设置 → 网络 → Wi-Fi → 高级 → 代理
2. 配置 HTTP 代理：`47.243.177.166:3128`
3. 访问 `https://www.google.com`
4. 如果成功，说明代理正常，问题在手机配置

---

## 📱 iPhone 代理配置检查清单

- [ ] 使用 Wi-Fi（不是数据流量）
- [ ] HTTP 代理设置为"手动"
- [ ] 服务器：`47.243.177.166`
- [ ] 端口：`3128`
- [ ] 认证：关闭
- [ ] 保存后重新连接 Wi-Fi

---

## 🔄 重新配置步骤

如果仍然不行，尝试：

1. **完全关闭代理**：
   - 设置 → Wi-Fi → 点击网络 → HTTP 代理 → 关闭
   - 保存

2. **重新配置**：
   - 设置 → Wi-Fi → 点击网络 → HTTP 代理 → 手动
   - 服务器：`47.243.177.166`
   - 端口：`3128`
   - 保存

3. **断开并重新连接 Wi-Fi**：
   - 关闭 Wi-Fi
   - 等待 5 秒
   - 重新打开 Wi-Fi
   - 重新连接

4. **测试访问**：
   - 先访问 `http://www.baidu.com`（测试基本连接）
   - 再访问 `https://www.google.com`（测试 HTTPS）

---

## 🆘 如果所有方法都不行

### 备选方案：使用 Mac 热点

1. **在 Mac 上配置代理**（指向服务器）
2. **Mac 开启 Wi-Fi 热点**
3. **手机连接 Mac 热点**
4. **在手机 Wi-Fi 设置中配置代理**

这样手机通过 Mac 访问，Mac 通过服务器代理访问 Google。

---

## 📝 需要的信息

如果问题仍然存在，请提供：

1. **手机代理配置截图**（显示服务器和端口）
2. **访问的具体网址**（是 Google 还是其他网站）
3. **具体错误信息**（"网址无效"还是其他）
4. **Squid 日志内容**（如果有）

---

**最后更新**：2025-11-26








