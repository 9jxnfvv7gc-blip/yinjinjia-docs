#!/usr/bin/env python3
"""
在服务器上运行此脚本来创建 video_server.py
使用方法：python3 create_video_server.py
"""

import base64
import os

# video_server.py 的 base64 编码
encoded_content = """IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIK566A5Y2V55qE6KeG6aKR5pyN5Yqh5ZmoCuWcqOS9oOeahOeUteiEkeS4iui/kOihjOi/meS4quiEmuacrO+8jOaKiuS9oOeahOinhumikeebruW9leWIhuS6q+WIsOe9kee7nOS4igrlhbbku5bkurrlsLHlj6/ku6XpgJrov4fkvaDnmoQgSVAg5Zyw5Z2A6K6/6Zeu6L+Z5Lqb6KeG6aKRCiIiIgoKaW1wb3J0IGh0dHAuc2VydmVyCmltcG9ydCBzb2NrZXRzZXJ2ZXIKaW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBjZ2kKaW1wb3J0IHNodXRpbAppbXBvcnQgc29ja2V0CmltcG9ydCByZQpmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgdW5xdW90ZSwgcGFyc2VfcXMKaW1wb3J0IHRlbXBmaWxlCgpQT1JUID0gODA4MQpWSURFT19ST09UID0gIi9Wb2x1bWVzL0V4cGFuc2lvbiIgICMg5pS55oiQ5L2g55qE6KeG6aKR5qC555uu5b2V6Lev5b6ECgpjbGFzcyBWaWRlb0hhbmRsZXIoaHR0cC5zZXJ2ZXIuU2ltcGxlSFRUUFJlcXVlc3RIYW5kbGVyKToKICAgIGRlZiBlbmRfaGVhZGVycyhzZWxmKToKICAgICAgICAjIOWFgeiuuOi3qOWfn+iuv+mXru+8jOi/meagtyBGbHV0dGVyIEFwcCDlj6/ku6Xku47ku7vkvZXlnLDmlrnorr/pl64KICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpCiAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctTWV0aG9kcycsICdHRVQsIFBPU1QsIE9QVElPTlMnKQogICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnMnLCAnKicpCiAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQWNjZXNzLUNvbnRyb2wtTWF4LUFnZScsICczNjAwJykKICAgICAgICBzdXBlcigpLmVuZF9oZWFkZXJzKCkKCiAgICBkZWYgZG9fT1BUSU9OUyhzZWxmKToKICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQoKICAgIGRlZiBkb19QT1NUKHNlbGYpOgogICAgICAgIGlmIHNlbGYucGF0aCA9PSAnL2FwaS91cGxvYWQnOgogICAgICAgICAgICAjIOWkhOeQhuaWh+S7tuS4iuS8oAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIOino+aekCBtdWx0aXBhcnQvZm9ybS1kYXRhCiAgICAgICAgICAgICAgICBmb3JtID0gY2dpLkZpZWxkU3RvcmFnZSgKICAgICAgICAgICAgICAgICAgICBmcD1zZWxmLnJmaWxlLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9c2VsZi5oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgIGVudmlyb249eydSRVFVRVNUX01FVEhPRCc6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDT05URU5UX1RZUEUnOiBzZWxmLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOiOt+WPluWIhuexu+WQjeensAogICAgICAgICAgICAgICAgaWYgJ2NhdGVnb3J5JyBub3QgaW4gZm9ybToKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDAwLCAiTWlzc2luZyBjYXRlZ29yeSBwYXJhbWV0ZXIiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjYXRlZ29yeV9uYW1lID0gZm9ybVsnY2F0ZWdvcnknXS52YWx1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOiOt+WPluS4iuS8oOeahOaWh+S7tgogICAgICAgICAgICAgICAgaWYgJ2ZpbGUnIG5vdCBpbiBmb3JtOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDAsICJNaXNzaW5nIGZpbGUgcGFyYW1ldGVyIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZmlsZV9pdGVtID0gZm9ybVsnZmlsZSddCiAgICAgICAgICAgICAgICBpZiBub3QgZmlsZV9pdGVtLmZpbGVuYW1lOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDAsICJObyBmaWxlIHNlbGVjdGVkIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZmlsZW5hbWUgPSBvcy5wYXRoLmJhc2VuYW1lKGZpbGVfaXRlbS5maWxlbmFtZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDnoa7kv53liIbnsbvmlofku7blpLnlrZjlnKjvvIjmlK/mjIHkuoznuqfliIbnsbvvvJrniLbliIbnsbsv5a2Q5YiG57G777yJCiAgICAgICAgICAgICAgICAjIOWmguaenCBjYXRlZ29yeV9uYW1lIOWMheWQqyAiLyLvvIzor7TmmI7mmK/kuoznuqfliIbnsbsKICAgICAgICAgICAgICAgIGlmICcvJyBpbiBjYXRlZ29yeV9uYW1lOgogICAgICAgICAgICAgICAgICAgICMg5LqM57qn5YiG57G777ya54i25YiG57G7L+WtkOWIhuexuwogICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5X3BhdGggPSBvcy5wYXRoLmpvaW4oVklERU9fUk9PVCwgY2F0ZWdvcnlfbmFtZSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyDkuIDnuqfliIbnsbsKICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeV9wYXRoID0gb3MucGF0aC5qb2luKFZJREVPX1JPT1QsIGNhdGVnb3J5X25hbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhjYXRlZ29yeV9wYXRoKToKICAgICAgICAgICAgICAgICAgICBvcy5tYWtlZGlycyhjYXRlZ29yeV9wYXRoLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYi5Yib5bu65YiG57G75paH5Lu25aS5OiB7Y2F0ZWdvcnlfcGF0aH0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOS/neWtmOaWh+S7tgogICAgICAgICAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKGNhdGVnb3J5X3BhdGgsIGZpbGVuYW1lKQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBmaWxlX2RhdGEgPSBmaWxlX2l0ZW0uZmlsZS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGZpbGVfZGF0YSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZmlsZV9zaXplID0gb3MucGF0aC5nZXRzaXplKGZpbGVfcGF0aCkKICAgICAgICAgICAgICAgIHByaW50KGYi5oiQ5Yqf5LiK5Lyg5paH5Lu2OiB7ZmlsZV9wYXRofSAoe2ZpbGVfc2l6ZX0g5a2X6IqCKSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg6L+U5Zue5oiQ5Yqf5ZON5bqUCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAn5paH5Lu25LiK5Lyg5oiQ5YqfJywKICAgICAgICAgICAgICAgICAgICAnZmlsZW5hbWUnOiBmaWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnknOiBjYXRlZ29yeV9uYW1lLAogICAgICAgICAgICAgICAgICAgICdzaXplJzogZmlsZV9zaXplCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UsIGVuc3VyZV9hc2NpaT1GYWxzZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGltcG9ydCB0cmFjZWJhY2sKICAgICAgICAgICAgICAgIHByaW50KGYi5LiK5Lyg6ZSZ6K+vOiB7ZX0iKQogICAgICAgICAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNTAwLCBmIlVwbG9hZCBmYWlsZWQ6IHtzdHIoZSl9IikKICAgICAgICBlbGlmIHNlbGYucGF0aCA9PSAnL2FwaS9tb3ZlJzoKICAgICAgICAgICAgIyDlpITnkIbmlofku7bnp7vliqgKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY29udGVudF9sZW5ndGggPSBpbnQoc2VsZi5oZWFkZXJzLmdldCgnQ29udGVudC1MZW5ndGgnLCAwKSkKICAgICAgICAgICAgICAgIHBvc3RfZGF0YSA9IHNlbGYucmZpbGUucmVhZChjb250ZW50X2xlbmd0aCkKICAgICAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKHBvc3RfZGF0YS5kZWNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNvdXJjZV9wYXRoID0gZGF0YS5nZXQoJ3NvdXJjZV9wYXRoJykKICAgICAgICAgICAgICAgIHRhcmdldF9jYXRlZ29yeSA9IGRhdGEuZ2V0KCd0YXJnZXRfY2F0ZWdvcnknKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3Qgc291cmNlX3BhdGggb3Igbm90IHRhcmdldF9jYXRlZ29yeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDAwLCAiTWlzc2luZyBzb3VyY2VfcGF0aCBvciB0YXJnZXRfY2F0ZWdvcnkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOino+aekOa6kOaWh+S7tui3r+W+hO+8iOWPr+iDveaYr+ebuOWvuei3r+W+hOaIlue7neWvuei3r+W+hO+8iQogICAgICAgICAgICAgICAgcHJpbnQoZiLmlLbliLDnp7vliqjor7fmsYI6IHNvdXJjZV9wYXRoPXtzb3VyY2VfcGF0aH0sIHRhcmdldF9jYXRlZ29yeT17dGFyZ2V0X2NhdGVnb3J5fSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNvdXJjZV9wYXRoLnN0YXJ0c3dpdGgoJy92aWRlby8nKToKICAgICAgICAgICAgICAgICAgICAjIOS7jiBVUkwg6Lev5b6E6L2s5o2i5Li65paH5Lu257O757uf6Lev5b6ECiAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVfcGF0aCA9IHNvdXJjZV9wYXRoLnJlcGxhY2UoJy92aWRlby8nLCAnJykKICAgICAgICAgICAgICAgICAgICBzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihWSURFT19ST09ULCB1bnF1b3RlKHJlbGF0aXZlX3BhdGgpKQogICAgICAgICAgICAgICAgZWxpZiBzb3VyY2VfcGF0aC5zdGFydHN3aXRoKFZJREVPX1JPT1QpOgogICAgICAgICAgICAgICAgICAgIHNvdXJjZV9maWxlID0gc291cmNlX3BhdGgKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyDlgYforr7mmK/nm7jlr7not6/lvoTvvIjljrvmjonlvIDlpLTnmoQgL++8iQogICAgICAgICAgICAgICAgICAgIGlmIHNvdXJjZV9wYXRoLnN0YXJ0c3dpdGgoJy8nKToKICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlX3BhdGggPSBzb3VyY2VfcGF0aFsxOl0KICAgICAgICAgICAgICAgICAgICBzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihWSURFT19ST09ULCB1bnF1b3RlKHNvdXJjZV9wYXRoKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDmoIflh4bljJbot6/lvoTvvIjlpITnkIYgLi4g5ZKMIC7vvIkKICAgICAgICAgICAgICAgIHNvdXJjZV9maWxlID0gb3MucGF0aC5ub3JtcGF0aChzb3VyY2VfZmlsZSkKICAgICAgICAgICAgICAgIHByaW50KGYi6Kej5p6Q5ZCO55qE5rqQ5paH5Lu26Lev5b6EOiB7c291cmNlX2ZpbGV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKSBvciBub3Qgb3MucGF0aC5pc2ZpbGUoc291cmNlX2ZpbGUpOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYi5rqQ5paH5Lu25LiN5a2Y5ZyoOiB7c291cmNlX2ZpbGV9IikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDA0LCBmIlNvdXJjZSBmaWxlIG5vdCBmb3VuZDoge3NvdXJjZV9maWxlfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5p6E5bu655uu5qCH6Lev5b6ECiAgICAgICAgICAgICAgICBpZiAnLycgaW4gdGFyZ2V0X2NhdGVnb3J5OgogICAgICAgICAgICAgICAgICAgIHRhcmdldF9wYXRoID0gb3MucGF0aC5qb2luKFZJREVPX1JPT1QsIHRhcmdldF9jYXRlZ29yeSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3BhdGggPSBvcy5wYXRoLmpvaW4oVklERU9fUk9PVCwgdGFyZ2V0X2NhdGVnb3J5KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHModGFyZ2V0X3BhdGgpOgogICAgICAgICAgICAgICAgICAgIG9zLm1ha2VkaXJzKHRhcmdldF9wYXRoLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYi5Yib5bu655uu5qCH5YiG57G75paH5Lu25aS5OiB7dGFyZ2V0X3BhdGh9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDnp7vliqjmlofku7YKICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gb3MucGF0aC5iYXNlbmFtZShzb3VyY2VfZmlsZSkKICAgICAgICAgICAgICAgIHRhcmdldF9maWxlID0gb3MucGF0aC5qb2luKHRhcmdldF9wYXRoLCBmaWxlbmFtZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDlpoLmnpznm67moIfmlofku7blt7LlrZjlnKjvvIzmt7vliqDluo/lj7cKICAgICAgICAgICAgICAgIGNvdW50ZXIgPSAxCiAgICAgICAgICAgICAgICBvcmlnaW5hbF90YXJnZXQgPSB0YXJnZXRfZmlsZQogICAgICAgICAgICAgICAgd2hpbGUgb3MucGF0aC5leGlzdHModGFyZ2V0X2ZpbGUpOgogICAgICAgICAgICAgICAgICAgIG5hbWUsIGV4dCA9IG9zLnBhdGguc3BsaXRleHQoZmlsZW5hbWUpCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2ZpbGUgPSBvcy5wYXRoLmpvaW4odGFyZ2V0X3BhdGgsIGYie25hbWV9X3tjb3VudGVyfXtleHR9IikKICAgICAgICAgICAgICAgICAgICBjb3VudGVyICs9IDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2h1dGlsLm1vdmUoc291cmNlX2ZpbGUsIHRhcmdldF9maWxlKQogICAgICAgICAgICAgICAgcHJpbnQoZiLmiJDlip/np7vliqjmlofku7Y6IHtzb3VyY2VfZmlsZX0gLT4ge3RhcmdldF9maWxlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg6L+U5Zue5oiQ5Yqf5ZON5bqUCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAn5paH5Lu256e75Yqo5oiQ5YqfJywKICAgICAgICAgICAgICAgICAgICAnbmV3X3BhdGgnOiBvcy5wYXRoLnJlbHBhdGgodGFyZ2V0X2ZpbGUsIFZJREVPX1JPT1QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UsIGVuc3VyZV9hc2NpaT1GYWxzZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGltcG9ydCB0cmFjZWJhY2sKICAgICAgICAgICAgICAgIHByaW50KGYi56e75Yqo5paH5Lu26ZSZ6K+vOiB7ZX0iKQogICAgICAgICAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNTAwLCBmIk1vdmUgZmFpbGVkOiB7c3RyKGUpfSIpCiAgICAgICAgZWxpZiBzZWxmLnBhdGggPT0gJy9hcGkvZGVsZXRlJzoKICAgICAgICAgICAgIyDlpITnkIbmlofku7bliKDpmaQKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY29udGVudF9sZW5ndGggPSBpbnQoc2VsZi5oZWFkZXJzLmdldCgnQ29udGVudC1MZW5ndGgnLCAwKSkKICAgICAgICAgICAgICAgIHBvc3RfZGF0YSA9IHNlbGYucmZpbGUucmVhZChjb250ZW50X2xlbmd0aCkKICAgICAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKHBvc3RfZGF0YS5kZWNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IGRhdGEuZ2V0KCdmaWxlX3BhdGgnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgZmlsZV9wYXRoOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDAsICJNaXNzaW5nIGZpbGVfcGF0aCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg6Kej5p6Q5paH5Lu26Lev5b6E77yI5Y+v6IO95piv55u45a+56Lev5b6E5oiW57ud5a+56Lev5b6E77yJCiAgICAgICAgICAgICAgICBwcmludChmIuaUtuWIsOWIoOmZpOivt+axgjogZmlsZV9wYXRoPXtmaWxlX3BhdGh9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgZmlsZV9wYXRoLnN0YXJ0c3dpdGgoJy92aWRlby8nKSBvciBmaWxlX3BhdGguc3RhcnRzd2l0aCgnL211c2ljLycpOgogICAgICAgICAgICAgICAgICAgICMg5LuOIFVSTCDot6/lvoTovazmjaLkuLrmlofku7bns7vnu5/ot6/lvoQKICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZV9wYXRoID0gZmlsZV9wYXRoLnJlcGxhY2UoJy92aWRlby8nLCAnJykucmVwbGFjZSgnL211c2ljLycsICcnKQogICAgICAgICAgICAgICAgICAgIHRhcmdldF9maWxlID0gb3MucGF0aC5qb2luKFZJREVPX1JPT1QsIHVucXVvdGUocmVsYXRpdmVfcGF0aCkpCiAgICAgICAgICAgICAgICBlbGlmIGZpbGVfcGF0aC5zdGFydHN3aXRoKFZJREVPX1JPT1QpOgogICAgICAgICAgICAgICAgICAgIHRhcmdldF9maWxlID0gZmlsZV9wYXRoCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMg5YGH6K6+5piv55u45a+56Lev5b6E77yI5Y675o6J5byA5aS055qEIC/vvIkKICAgICAgICAgICAgICAgICAgICBpZiBmaWxlX3BhdGguc3RhcnRzd2l0aCgnLycpOgogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBmaWxlX3BhdGhbMTpdCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2ZpbGUgPSBvcy5wYXRoLmpvaW4oVklERU9fUk9PVCwgdW5xdW90ZShmaWxlX3BhdGgpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOagh+WHhuWMlui3r+W+hO+8iOWkhOeQhiAuLiDlkowgLu+8iQogICAgICAgICAgICAgICAgdGFyZ2V0X2ZpbGUgPSBvcy5wYXRoLm5vcm1wYXRoKHRhcmdldF9maWxlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOWuieWFqOajgOafpe+8muehruS/neaWh+S7tuWcqCBWSURFT19ST09UIOebruW9leS4iwogICAgICAgICAgICAgICAgaWYgbm90IHRhcmdldF9maWxlLnN0YXJ0c3dpdGgob3MucGF0aC5hYnNwYXRoKFZJREVPX1JPT1QpKToKICAgICAgICAgICAgICAgICAgICBwcmludChmIuWuieWFqOmUmeivr++8muWwneivleWIoOmZpCBWSURFT19ST09UIOWklueahOaWh+S7tjoge3RhcmdldF9maWxlfSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Vycm9yKDQwMywgIkFjY2VzcyBkZW5pZWQiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwcmludChmIuino+aekOWQjueahOaWh+S7tui3r+W+hDoge3RhcmdldF9maWxlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyh0YXJnZXRfZmlsZSkgb3Igbm90IG9zLnBhdGguaXNmaWxlKHRhcmdldF9maWxlKToKICAgICAgICAgICAgICAgICAgICBwcmludChmIuaWh+S7tuS4jeWtmOWcqDoge3RhcmdldF9maWxlfSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Vycm9yKDQwNCwgZiJGaWxlIG5vdCBmb3VuZDoge3RhcmdldF9maWxlfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5Yig6Zmk5paH5Lu2CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUodGFyZ2V0X2ZpbGUpCiAgICAgICAgICAgICAgICBwcmludChmIuaIkOWKn+WIoOmZpOaWh+S7tjoge3RhcmdldF9maWxlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg6L+U5Zue5oiQ5Yqf5ZON5bqUCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjAwKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAn5paH5Lu25Yig6Zmk5oiQ5YqfJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2VsZi53ZmlsZS53cml0ZShqc29uLmR1bXBzKHJlc3BvbnNlLCBlbnN1cmVfYXNjaWk9RmFsc2UpLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBpbXBvcnQgdHJhY2ViYWNrCiAgICAgICAgICAgICAgICBwcmludChmIuWIoOmZpOaWh+S7tumUmeivrzoge2V9IikKICAgICAgICAgICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Vycm9yKDUwMCwgZiJEZWxldGUgZmFpbGVkOiB7c3RyKGUpfSIpCiAgICAgICAgZWxpZiBzZWxmLnBhdGggPT0gJy9hcGkvaW5mbyc6CiAgICAgICAgICAgICMg6I635Y+W5paH5Lu25L+h5oGvCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHF1ZXJ5X3BhcmFtcyA9IHBhcnNlX3FzKHNlbGYucGF0aC5zcGxpdCgnPycpWzFdIGlmICc/JyBpbiBzZWxmLnBhdGggZWxzZSAnJykKICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IHF1ZXJ5X3BhcmFtcy5nZXQoJ2ZpbGVfcGF0aCcsIFtOb25lXSlbMF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGZpbGVfcGF0aDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDAwLCAiTWlzc2luZyBmaWxlX3BhdGggcGFyYW1ldGVyIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDop6PmnpDmlofku7bot6/lvoQKICAgICAgICAgICAgICAgIGlmIGZpbGVfcGF0aC5zdGFydHN3aXRoKCcvdmlkZW8vJykgb3IgZmlsZV9wYXRoLnN0YXJ0c3dpdGgoJy9tdXNpYy8nKToKICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZV9wYXRoID0gZmlsZV9wYXRoLnJlcGxhY2UoJy92aWRlby8nLCAnJykucmVwbGFjZSgnL211c2ljLycsICcnKQogICAgICAgICAgICAgICAgICAgIHRhcmdldF9maWxlID0gb3MucGF0aC5qb2luKFZJREVPX1JPT1QsIHVucXVvdGUocmVsYXRpdmVfcGF0aCkpCiAgICAgICAgICAgICAgICBlbGlmIGZpbGVfcGF0aC5zdGFydHN3aXRoKFZJREVPX1JPT1QpOgogICAgICAgICAgICAgICAgICAgIHRhcmdldF9maWxlID0gZmlsZV9wYXRoCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIGZpbGVfcGF0aC5zdGFydHN3aXRoKCcvJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfcGF0aFsxOl0KICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZmlsZSA9IG9zLnBhdGguam9pbihWSURFT19ST09ULCB1bnF1b3RlKGZpbGVfcGF0aCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhcmdldF9maWxlID0gb3MucGF0aC5ub3JtcGF0aCh0YXJnZXRfZmlsZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHRhcmdldF9maWxlKSBvciBub3Qgb3MucGF0aC5pc2ZpbGUodGFyZ2V0X2ZpbGUpOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDQsICJGaWxlIG5vdCBmb3VuZCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg6I635Y+W5paH5Lu25L+h5oGvCiAgICAgICAgICAgICAgICBmaWxlX3NpemUgPSBvcy5wYXRoLmdldHNpemUodGFyZ2V0X2ZpbGUpCiAgICAgICAgICAgICAgICBmaWxlX3N0YXQgPSBvcy5zdGF0KHRhcmdldF9maWxlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpbXBvcnQgZGF0ZXRpbWUKICAgICAgICAgICAgICAgIGNyZWF0ZWRfdGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLmZyb210aW1lc3RhbXAoZmlsZV9zdGF0LnN0X2N0aW1lKS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKQogICAgICAgICAgICAgICAgbW9kaWZpZWRfdGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLmZyb210aW1lc3RhbXAoZmlsZV9zdGF0LnN0X210aW1lKS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOagvOW8j+WMluaWh+S7tuWkp+WwjwogICAgICAgICAgICAgICAgZGVmIGZvcm1hdF9zaXplKHNpemUpOgogICAgICAgICAgICAgICAgICAgIGZvciB1bml0IGluIFsnQicsICdLQicsICdNQicsICdHQicsICdUQiddOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzaXplIDwgMTAyNC4wOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYie3NpemU6LjJmfSB7dW5pdH0iCiAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgLz0gMTAyNC4wCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYie3NpemU6LjJmfSBQQiIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykKICAgICAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7CiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICdmaWxlbmFtZSc6IG9zLnBhdGguYmFzZW5hbWUodGFyZ2V0X2ZpbGUpLAogICAgICAgICAgICAgICAgICAgICdzaXplJzogZmlsZV9zaXplLAogICAgICAgICAgICAgICAgICAgICdzaXplX2Zvcm1hdHRlZCc6IGZvcm1hdF9zaXplKGZpbGVfc2l6ZSksCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfdGltZSc6IGNyZWF0ZWRfdGltZSwKICAgICAgICAgICAgICAgICAgICAnbW9kaWZpZWRfdGltZSc6IG1vZGlmaWVkX3RpbWUsCiAgICAgICAgICAgICAgICAgICAgJ3BhdGgnOiBvcy5wYXRoLnJlbHBhdGgodGFyZ2V0X2ZpbGUsIFZJREVPX1JPT1QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMocmVzcG9uc2UsIGVuc3VyZV9hc2NpaT1GYWxzZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGltcG9ydCB0cmFjZWJhY2sKICAgICAgICAgICAgICAgIHByaW50KGYi6I635Y+W5paH5Lu25L+h5oGv6ZSZ6K+vOiB7ZX0iKQogICAgICAgICAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNTAwLCBmIkdldCBpbmZvIGZhaWxlZDoge3N0cihlKX0iKQogICAgICAgIGVsaWYgc2VsZi5wYXRoID09ICcvYXBpL3JlbmFtZSc6CiAgICAgICAgICAgICMg5aSE55CG5paH5Lu26YeN5ZG95ZCNCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNvbnRlbnRfbGVuZ3RoID0gaW50KHNlbGYuaGVhZGVycy5nZXQoJ0NvbnRlbnQtTGVuZ3RoJywgMCkpCiAgICAgICAgICAgICAgICBwb3N0X2RhdGEgPSBzZWxmLnJmaWxlLnJlYWQoY29udGVudF9sZW5ndGgpCiAgICAgICAgICAgICAgICBkYXRhID0ganNvbi5sb2Fkcyhwb3N0X2RhdGEuZGVjb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBkYXRhLmdldCgnZmlsZV9wYXRoJykKICAgICAgICAgICAgICAgIG5ld19uYW1lID0gZGF0YS5nZXQoJ25ld19uYW1lJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGZpbGVfcGF0aCBvciBub3QgbmV3X25hbWU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Vycm9yKDQwMCwgIk1pc3NpbmcgZmlsZV9wYXRoIG9yIG5ld19uYW1lIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDop6PmnpDmlofku7bot6/lvoQKICAgICAgICAgICAgICAgIHByaW50KGYi5pS25Yiw6YeN5ZG95ZCN6K+35rGCOiBmaWxlX3BhdGg9e2ZpbGVfcGF0aH0sIG5ld19uYW1lPXtuZXdfbmFtZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOWwneivleWkmuenjei3r+W+hOagvOW8jwogICAgICAgICAgICAgICAgdGFyZ2V0X2ZpbGUgPSBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5pa55rOVMTogVVJM6Lev5b6E5qC85byPICgvdmlkZW8vLi4uIOaIliAvbXVzaWMvLi4uKQogICAgICAgICAgICAgICAgaWYgZmlsZV9wYXRoLnN0YXJ0c3dpdGgoJy92aWRlby8nKSBvciBmaWxlX3BhdGguc3RhcnRzd2l0aCgnL211c2ljLycpOgogICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlX3BhdGggPSBmaWxlX3BhdGgucmVwbGFjZSgnL3ZpZGVvLycsICcnKS5yZXBsYWNlKCcvbXVzaWMvJywgJycpCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2ZpbGUgPSBvcy5wYXRoLmpvaW4oVklERU9fUk9PVCwgdW5xdW90ZShyZWxhdGl2ZV9wYXRoKSkKICAgICAgICAgICAgICAgICAgICBwcmludChmIuaWueazlTHop6PmnpA6IHt0YXJnZXRfZmlsZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOaWueazlTI6IOe7neWvuei3r+W+hAogICAgICAgICAgICAgICAgZWxpZiBmaWxlX3BhdGguc3RhcnRzd2l0aChWSURFT19ST09UKToKICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZmlsZSA9IGZpbGVfcGF0aAogICAgICAgICAgICAgICAgICAgIHByaW50KGYi5pa55rOVMuino+aekDoge3RhcmdldF9maWxlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5pa55rOVMzog55u45a+56Lev5b6ECiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIGZpbGVfcGF0aC5zdGFydHN3aXRoKCcvJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfcGF0aFsxOl0KICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZmlsZSA9IG9zLnBhdGguam9pbihWSURFT19ST09ULCB1bnF1b3RlKGZpbGVfcGF0aCkpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLmlrnms5Uz6Kej5p6QOiB7dGFyZ2V0X2ZpbGV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGFyZ2V0X2ZpbGUgPSBvcy5wYXRoLm5vcm1wYXRoKHRhcmdldF9maWxlKQogICAgICAgICAgICAgICAgcHJpbnQoZiLmoIflh4bljJblkI7ot6/lvoQ6IHt0YXJnZXRfZmlsZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiJWSURFT19ST09UOiB7b3MucGF0aC5hYnNwYXRoKFZJREVPX1JPT1QpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5a6J5YWo5qOA5p+lCiAgICAgICAgICAgICAgICBhYnNfdmlkZW9fcm9vdCA9IG9zLnBhdGguYWJzcGF0aChWSURFT19ST09UKQogICAgICAgICAgICAgICAgYWJzX3RhcmdldF9maWxlID0gb3MucGF0aC5hYnNwYXRoKHRhcmdldF9maWxlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgYWJzX3RhcmdldF9maWxlLnN0YXJ0c3dpdGgoYWJzX3ZpZGVvX3Jvb3QpOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYi5a6J5YWo6ZSZ6K+v77ya5bCd6K+V6YeN5ZG95ZCNIFZJREVPX1JPT1Qg5aSW55qE5paH5Lu2IikKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgVklERU9fUk9PVDoge2Fic192aWRlb19yb290fSIpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIHRhcmdldF9maWxlOiB7YWJzX3RhcmdldF9maWxlfSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Vycm9yKDQwMywgIkFjY2VzcyBkZW5pZWQiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHModGFyZ2V0X2ZpbGUpOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYi5paH5Lu25LiN5a2Y5ZyoOiB7dGFyZ2V0X2ZpbGV9IikKICAgICAgICAgICAgICAgICAgICBwcmludChmIuebruW9leaYr+WQpuWtmOWcqDoge29zLnBhdGguZXhpc3RzKG9zLnBhdGguZGlybmFtZSh0YXJnZXRfZmlsZSkpfSIpCiAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5kaXJuYW1lKHRhcmdldF9maWxlKSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYi55uu5b2V5YaF5a65OiB7b3MubGlzdGRpcihvcy5wYXRoLmRpcm5hbWUodGFyZ2V0X2ZpbGUpKX0iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDQsIGYiRmlsZSBub3QgZm91bmQ6IHt0YXJnZXRfZmlsZX0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUodGFyZ2V0X2ZpbGUpOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYi5LiN5piv5paH5Lu2OiB7dGFyZ2V0X2ZpbGV9IikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDA0LCAiTm90IGEgZmlsZSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg6I635Y+W5Y6f5paH5Lu25omp5bGV5ZCNCiAgICAgICAgICAgICAgICBfLCBleHQgPSBvcy5wYXRoLnNwbGl0ZXh0KHRhcmdldF9maWxlKQogICAgICAgICAgICAgICAgIyDnoa7kv53mlrDmlofku7blkI3ljIXlkKvmianlsZXlkI0KICAgICAgICAgICAgICAgIGlmIG5vdCBuZXdfbmFtZS5lbmRzd2l0aChleHQpOgogICAgICAgICAgICAgICAgICAgIG5ld19uYW1lID0gbmV3X25hbWUgKyBleHQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDmnoTlu7rmlrDmlofku7bot6/lvoQKICAgICAgICAgICAgICAgIG5ld19maWxlID0gb3MucGF0aC5qb2luKG9zLnBhdGguZGlybmFtZSh0YXJnZXRfZmlsZSksIG5ld19uYW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOajgOafpeaWsOaWh+S7tuWQjeaYr+WQpuW3suWtmOWcqAogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMobmV3X2ZpbGUpOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDksICJGaWxlIHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDph43lkb3lkI3mlofku7YKICAgICAgICAgICAgICAgIG9zLnJlbmFtZSh0YXJnZXRfZmlsZSwgbmV3X2ZpbGUpCiAgICAgICAgICAgICAgICBwcmludChmIuaIkOWKn+mHjeWRveWQjeaWh+S7tjoge3RhcmdldF9maWxlfSAtPiB7bmV3X2ZpbGV9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDov5Tlm57miJDlip/lk43lupQKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICfmlofku7bph43lkb3lkI3miJDlip8nLAogICAgICAgICAgICAgICAgICAgICduZXdfcGF0aCc6IG9zLnBhdGgucmVscGF0aChuZXdfZmlsZSwgVklERU9fUk9PVCksCiAgICAgICAgICAgICAgICAgICAgJ25ld19uYW1lJzogbmV3X25hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSwgZW5zdXJlX2FzY2lpPUZhbHNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgaW1wb3J0IHRyYWNlYmFjawogICAgICAgICAgICAgICAgcHJpbnQoZiLph43lkb3lkI3mlofku7bplJnor686IHtlfSIpCiAgICAgICAgICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig1MDAsIGYiUmVuYW1lIGZhaWxlZDoge3N0cihlKX0iKQogICAgICAgIGVsaWYgc2VsZi5wYXRoID09ICcvYXBpL2JhdGNoX3JlbmFtZSc6CiAgICAgICAgICAgICMg5aSE55CG5om56YeP6YeN5ZG95ZCNCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNvbnRlbnRfbGVuZ3RoID0gaW50KHNlbGYuaGVhZGVycy5nZXQoJ0NvbnRlbnQtTGVuZ3RoJywgMCkpCiAgICAgICAgICAgICAgICBwb3N0X2RhdGEgPSBzZWxmLnJmaWxlLnJlYWQoY29udGVudF9sZW5ndGgpCiAgICAgICAgICAgICAgICBkYXRhID0ganNvbi5sb2Fkcyhwb3N0X2RhdGEuZGVjb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZW5hbWVfbGlzdCA9IGRhdGEuZ2V0KCdyZW5hbWVfbGlzdCcsIFtdKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgcmVuYW1lX2xpc3Q6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Vycm9yKDQwMCwgIk1pc3NpbmcgcmVuYW1lX2xpc3QiKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXN1bHRzID0gW10KICAgICAgICAgICAgICAgIHN1Y2Nlc3NfY291bnQgPSAwCiAgICAgICAgICAgICAgICBmYWlsX2NvdW50ID0gMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgaXRlbSBpbiByZW5hbWVfbGlzdDoKICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBpdGVtLmdldCgnZmlsZV9wYXRoJykKICAgICAgICAgICAgICAgICAgICBuZXdfbmFtZSA9IGl0ZW0uZ2V0KCduZXdfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGZpbGVfcGF0aCBvciBub3QgbmV3X25hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmaWxlX3BhdGgnOiBmaWxlX3BhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJzogJ01pc3NpbmcgZmlsZV9wYXRoIG9yIG5ld19uYW1lJwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBmYWlsX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMg6Kej5p6Q5paH5Lu26Lev5b6E77yI5L2/55So5LiO5Y2V5Liq6YeN5ZG95ZCN55u45ZCM55qE6YC76L6R77yJCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9maWxlID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmlsZV9wYXRoLnN0YXJ0c3dpdGgoJy92aWRlby8nKSBvciBmaWxlX3BhdGguc3RhcnRzd2l0aCgnL211c2ljLycpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVfcGF0aCA9IGZpbGVfcGF0aC5yZXBsYWNlKCcvdmlkZW8vJywgJycpLnJlcGxhY2UoJy9tdXNpYy8nLCAnJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9maWxlID0gb3MucGF0aC5qb2luKFZJREVPX1JPT1QsIHVucXVvdGUocmVsYXRpdmVfcGF0aCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgZmlsZV9wYXRoLnN0YXJ0c3dpdGgoVklERU9fUk9PVCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZmlsZSA9IGZpbGVfcGF0aAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmlsZV9wYXRoLnN0YXJ0c3dpdGgoJy8nKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBmaWxlX3BhdGhbMTpdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZmlsZSA9IG9zLnBhdGguam9pbihWSURFT19ST09ULCB1bnF1b3RlKGZpbGVfcGF0aCkpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZmlsZSA9IG9zLnBhdGgubm9ybXBhdGgodGFyZ2V0X2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOWuieWFqOajgOafpQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5hYnNwYXRoKHRhcmdldF9maWxlKS5zdGFydHN3aXRoKG9zLnBhdGguYWJzcGF0aChWSURFT19ST09UKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGVfcGF0aCc6IGZpbGVfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvcic6ICdBY2Nlc3MgZGVuaWVkJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyh0YXJnZXRfZmlsZSkgb3Igbm90IG9zLnBhdGguaXNmaWxlKHRhcmdldF9maWxlKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmlsZV9wYXRoJzogZmlsZV9wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJzogJ0ZpbGUgbm90IGZvdW5kJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMg6I635Y+W5Y6f5paH5Lu25omp5bGV5ZCNCiAgICAgICAgICAgICAgICAgICAgICAgIF8sIGV4dCA9IG9zLnBhdGguc3BsaXRleHQodGFyZ2V0X2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBuZXdfbmFtZS5lbmRzd2l0aChleHQpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3X25hbWUgPSBuZXdfbmFtZSArIGV4dAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDmnoTlu7rmlrDmlofku7bot6/lvoQKICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2ZpbGUgPSBvcy5wYXRoLmpvaW4ob3MucGF0aC5kaXJuYW1lKHRhcmdldF9maWxlKSwgbmV3X25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOajgOafpeaWsOaWh+S7tuWQjeaYr+WQpuW3suWtmOWcqAogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhuZXdfZmlsZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGVfcGF0aCc6IGZpbGVfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvcic6ICdGaWxlIHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMg6YeN5ZG95ZCN5paH5Lu2CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnJlbmFtZSh0YXJnZXRfZmlsZSwgbmV3X2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYi5oiQ5Yqf6YeN5ZG95ZCN5paH5Lu2OiB7dGFyZ2V0X2ZpbGV9IC0+IHtuZXdfZmlsZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGVfcGF0aCc6IGZpbGVfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduZXdfcGF0aCc6IG9zLnBhdGgucmVscGF0aChuZXdfZmlsZSwgVklERU9fUk9PVCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmV3X25hbWUnOiBuZXdfbmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIuaJuemHj+mHjeWRveWQjeWNleS4quaWh+S7tumUmeivrzoge2ZpbGVfcGF0aH0gLSB7ZX0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmlsZV9wYXRoJzogZmlsZV9wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvcic6IHN0cihlKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBmYWlsX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDov5Tlm57nu5PmnpwKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gewogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6IGYn5om56YeP6YeN5ZG95ZCN5a6M5oiQ77ya5oiQ5YqfIHtzdWNjZXNzX2NvdW50fSDkuKrvvIzlpLHotKUge2ZhaWxfY291bnR9IOS4qicsCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3NfY291bnQnOiBzdWNjZXNzX2NvdW50LAogICAgICAgICAgICAgICAgICAgICdmYWlsX2NvdW50JzogZmFpbF9jb3VudCwKICAgICAgICAgICAgICAgICAgICAncmVzdWx0cyc6IHJlc3VsdHMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSwgZW5zdXJlX2FzY2lpPUZhbHNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgaW1wb3J0IHRyYWNlYmFjawogICAgICAgICAgICAgICAgcHJpbnQoZiLmibnph4/ph43lkb3lkI3plJnor686IHtlfSIpCiAgICAgICAgICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig1MDAsIGYiQmF0Y2ggcmVuYW1lIGZhaWxlZDoge3N0cihlKX0iKQogICAgICAgIGVsaWYgc2VsZi5wYXRoID09ICcvYXBpL3NhdmVfb3JkZXInOgogICAgICAgICAgICAjIOS/neWtmOaWh+S7tuaOkuW6j+mhuuW6jwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjb250ZW50X2xlbmd0aCA9IGludChzZWxmLmhlYWRlcnMuZ2V0KCdDb250ZW50LUxlbmd0aCcsIDApKQogICAgICAgICAgICAgICAgcG9zdF9kYXRhID0gc2VsZi5yZmlsZS5yZWFkKGNvbnRlbnRfbGVuZ3RoKQogICAgICAgICAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMocG9zdF9kYXRhLmRlY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2F0ZWdvcnkgPSBkYXRhLmdldCgnY2F0ZWdvcnknKQogICAgICAgICAgICAgICAgZmlsZV9vcmRlciA9IGRhdGEuZ2V0KCdmaWxlX29yZGVyJywgW10pICAjIOaWh+S7tklE5YiX6KGo77yM5oyJ6aG65bqPCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBjYXRlZ29yeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDAwLCAiTWlzc2luZyBjYXRlZ29yeSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5L+d5a2Y5o6S5bqP5YiwSlNPTuaWh+S7tgogICAgICAgICAgICAgICAgb3JkZXJfZmlsZSA9IG9zLnBhdGguam9pbihWSURFT19ST09ULCAnLmZpbGVfb3JkZXJzLmpzb24nKQogICAgICAgICAgICAgICAgb3JkZXJzID0ge30KICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9yZGVyX2ZpbGUpOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKG9yZGVyX2ZpbGUsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVycyA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXJzID0ge30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgb3JkZXJzW2NhdGVnb3J5XSA9IGZpbGVfb3JkZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2l0aCBvcGVuKG9yZGVyX2ZpbGUsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBqc29uLmR1bXAob3JkZXJzLCBmLCBlbnN1cmVfYXNjaWk9RmFsc2UsIGluZGVudD0yKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwcmludChmIuS/neWtmOaOkuW6j+mhuuW6jzoge2NhdGVnb3J5fSAtIHtsZW4oZmlsZV9vcmRlcil9IOS4quaWh+S7tiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpCiAgICAgICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geydzdWNjZXNzJzogVHJ1ZSwgJ21lc3NhZ2UnOiAn5o6S5bqP5bey5L+d5a2YJ30KICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSwgZW5zdXJlX2FzY2lpPUZhbHNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgaW1wb3J0IHRyYWNlYmFjawogICAgICAgICAgICAgICAgcHJpbnQoZiLkv53lrZjmjpLluo/plJnor686IHtlfSIpCiAgICAgICAgICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig1MDAsIGYiU2F2ZSBvcmRlciBmYWlsZWQ6IHtzdHIoZSl9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDA0LCAiTm90IGZvdW5kIikKCiAgICBkZWYgZG9fR0VUKHNlbGYpOgogICAgICAgIGlmIHNlbGYucGF0aCA9PSAnL2FwaS9jYXRlZ29yaWVzJzoKICAgICAgICAgICAgIyDov5Tlm57liIbnsbvliJfooajvvIjljbPkvb/mlofku7blpLnkuI3lrZjlnKjkuZ/ov5Tlm57miYDmnInliIbnsbvvvIkKICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5a6a5LmJ5omA5pyJ5YiG57G777yI6KeG6aKRK+mfs+S5kO+8iQogICAgICAgICAgICBhbGxfY2F0ZWdvcmllcyA9IFsn57qq5b2V54mHJywgJ+enkeaKgCcsICfpn7PkuZAnLCAn5bCR5YS/JywgJ+eUteW9sScsICflrabloIInLCAn55Sf5rS7JywgJ+iJuuacrycsICfogrLlhL8nLCAn55+l6K+GJywgJ+aXtuWwmicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAn5Y6f5YibJywgJ+a1geihjCcsICfnu4/lhbgnXSAgIyDpn7PkuZDliIbnsbsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNhdGVnb3JpZXMgPSBbXQogICAgICAgICAgICAjIOiOt+WPluWunumZheWtmOWcqOeahOaWh+S7tuWkuQogICAgICAgICAgICBleGlzdGluZ19mb2xkZXJzID0gc2V0KCkKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoVklERU9fUk9PVCk6CiAgICAgICAgICAgICAgICBmb3IgaXRlbSBpbiBvcy5saXN0ZGlyKFZJREVPX1JPT1QpOgogICAgICAgICAgICAgICAgICAgIGl0ZW1fcGF0aCA9IG9zLnBhdGguam9pbihWSURFT19ST09ULCBpdGVtKQogICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNkaXIoaXRlbV9wYXRoKToKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfZm9sZGVycy5hZGQoaXRlbSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5Li65q+P5Liq5YiG57G75Yib5bu65p2h55uuCiAgICAgICAgICAgIGZvciBjYXRfbmFtZSBpbiBhbGxfY2F0ZWdvcmllczoKICAgICAgICAgICAgICAgIGlmIGNhdF9uYW1lIGluIGV4aXN0aW5nX2ZvbGRlcnM6CiAgICAgICAgICAgICAgICAgICAgIyDnu5/orqHor6XliIbnsbvkuIvnmoTlqpLkvZPmlofku7bmlbDvvIjop4bpopEr6Z+z5LmQ77yJCiAgICAgICAgICAgICAgICAgICAgY2F0X3BhdGggPSBvcy5wYXRoLmpvaW4oVklERU9fUk9PVCwgY2F0X25hbWUpCiAgICAgICAgICAgICAgICAgICAgdmlkZW9fZXh0ZW5zaW9ucyA9IFsnLm1wNCcsICcubW92JywgJy5ta3YnLCAnLmF2aScsICcucm12YicsICcucm0nLCAnLndtdicsICcuZmx2JywgJy5mNHYnLCAnLm00dicsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLm1wZycsICcubXBlZycsICcuM2dwJywgJy53ZWJtJywgJy50cycsICcubXRzJywgJy52b2InLCAnLmRpdngnLCAnLnh2aWQnXQogICAgICAgICAgICAgICAgICAgIG11c2ljX2V4dGVuc2lvbnMgPSBbJy5tcDMnLCAnLm00YScsICcuZmxhYycsICcud2F2JywgJy5hYWMnLCAnLm9nZycsICcud21hJ10KICAgICAgICAgICAgICAgICAgICBhbGxfbWVkaWFfZXh0ZW5zaW9ucyA9IHZpZGVvX2V4dGVuc2lvbnMgKyBtdXNpY19leHRlbnNpb25zCiAgICAgICAgICAgICAgICAgICAgY291bnQgPSBzdW0oMSBmb3IgZiBpbiBvcy5saXN0ZGlyKGNhdF9wYXRoKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUob3MucGF0aC5qb2luKGNhdF9wYXRoLCBmKSkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBvcy5wYXRoLnNwbGl0ZXh0KGYpWzFdLmxvd2VyKCkgaW4gYWxsX21lZGlhX2V4dGVuc2lvbnMpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMg5paH5Lu25aS55LiN5a2Y5Zyo77yM6KeG6aKR5pWw5Li6IDAKICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICduYW1lJzogY2F0X25hbWUsCiAgICAgICAgICAgICAgICAgICAgJ2lkJzogY2F0X25hbWUsCiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogY291bnQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGpzb24uZHVtcHMoY2F0ZWdvcmllcywgZW5zdXJlX2FzY2lpPUZhbHNlKS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgIAogICAgICAgIGVsaWYgc2VsZi5wYXRoLnN0YXJ0c3dpdGgoJy9hcGkvbGlzdC8nKToKICAgICAgICAgICAgIyDov5Tlm57mn5DkuKrliIbnsbvkuIvnmoTop4bpopHliJfooajvvIjmlK/mjIHkuoznuqfliIbnsbvvvJrniLbliIbnsbsv5a2Q5YiG57G777yJCiAgICAgICAgICAgIGltcG9ydCBzeXMKICAgICAgICAgICAgIyDojrflj5bljp/lp4vot6/lvoQKICAgICAgICAgICAgcmF3X2NhdGVnb3J5ID0gc2VsZi5wYXRoLnJlcGxhY2UoJy9hcGkvbGlzdC8nLCAnJykKICAgICAgICAgICAgIyDlsJ3or5Xop6PnoIHvvIjlj6/og73lt7Lnu4/nvJbnoIHvvIzkuZ/lj6/og73msqHmnInvvIkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyDlhYjlsJ3or5Xop6PnoIHvvIjlpoLmnpzlt7Lnu4/nvJbnoIHvvIkKICAgICAgICAgICAgICAgIGNhdGVnb3J5ID0gdW5xdW90ZShyYXdfY2F0ZWdvcnkpCiAgICAgICAgICAgICAgICAjIOWmguaenOino+eggeWQjuWSjOWOn+Wni+ebuOWQjO+8jOivtOaYjuayoeaciee8luegge+8jOebtOaOpeS9v+eUqAogICAgICAgICAgICAgICAgaWYgY2F0ZWdvcnkgPT0gcmF3X2NhdGVnb3J5OgogICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5ID0gcmF3X2NhdGVnb3J5CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICMg5aaC5p6c6Kej56CB5aSx6LSl77yM55u05o6l5L2/55So5Y6f5aeL5YC8CiAgICAgICAgICAgICAgICBjYXRlZ29yeSA9IHJhd19jYXRlZ29yeQogICAgICAgICAgICAKICAgICAgICAgICAgIyDmlK/mjIHkuoznuqfliIbnsbvot6/lvoTvvIjljIXlkKsgIi8i77yJCiAgICAgICAgICAgIGNhdGVnb3J5X3BhdGggPSBvcy5wYXRoLmpvaW4oVklERU9fUk9PVCwgY2F0ZWdvcnkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOiwg+ivleS/oeaBr++8iOS9v+eUqHN5cy5zdGRlcnLnoa7kv53ovpPlh7rliLDml6Xlv5fvvIkKICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZShmIuWOn+Wni+i3r+W+hDoge3NlbGYucGF0aH1cbiIpCiAgICAgICAgICAgIHN5cy5zdGRlcnIud3JpdGUoZiLljp/lp4tjYXRlZ29yeToge3Jhd19jYXRlZ29yeX1cbiIpCiAgICAgICAgICAgIHN5cy5zdGRlcnIud3JpdGUoZiLop6PnoIHlkI5jYXRlZ29yeToge2NhdGVnb3J5fVxuIikKICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZShmIkFQSeWIl+ihqOivt+axgjogY2F0ZWdvcnk9e2NhdGVnb3J5fSwgY2F0ZWdvcnlfcGF0aD17Y2F0ZWdvcnlfcGF0aH1cbiIpCiAgICAgICAgICAgIHN5cy5zdGRlcnIud3JpdGUoZiJWSURFT19ST09UOiB7VklERU9fUk9PVH1cbiIpCiAgICAgICAgICAgIHN5cy5zdGRlcnIud3JpdGUoZiLot6/lvoTlrZjlnKg6IHtvcy5wYXRoLmV4aXN0cyhjYXRlZ29yeV9wYXRoKX1cbiIpCiAgICAgICAgICAgIHN5cy5zdGRlcnIuZmx1c2goKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKQogICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHZpZGVvcyA9IFtdCiAgICAgICAgICAgIHZpZGVvX2V4dGVuc2lvbnMgPSBbJy5tcDQnLCAnLm1vdicsICcubWt2JywgJy5hdmknLCAnLnJtdmInLCAnLnJtJywgJy53bXYnLCAnLmZsdicsICcuZjR2JywgJy5tNHYnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcubXBnJywgJy5tcGVnJywgJy4zZ3AnLCAnLndlYm0nLCAnLnRzJywgJy5tdHMnLCAnLnZvYicsICcuZGl2eCcsICcueHZpZCddCiAgICAgICAgICAgIG11c2ljX2V4dGVuc2lvbnMgPSBbJy5tcDMnLCAnLmZsYWMnLCAnLndhdicsICcuYWFjJywgJy5vZ2cnLCAnLndtYSddICAjIOenu+mZpG00Ye+8jOWboOS4uuaXoOazleaSreaUvgogICAgICAgICAgICBhbGxfbWVkaWFfZXh0ZW5zaW9ucyA9IHZpZGVvX2V4dGVuc2lvbnMgKyBtdXNpY19leHRlbnNpb25zCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhjYXRlZ29yeV9wYXRoKToKICAgICAgICAgICAgICAgIHN5cy5zdGRlcnIud3JpdGUoZiLnm67lvZXlrZjlnKjvvIzlvIDlp4vmiavmj4/mlofku7YuLi5cbiIpCiAgICAgICAgICAgICAgICBzeXMuc3RkZXJyLmZsdXNoKCkKICAgICAgICAgICAgICAgIGZpbGVfbGlzdCA9IFtdCiAgICAgICAgICAgICAgICBmb3IgZiBpbiBvcy5saXN0ZGlyKGNhdGVnb3J5X3BhdGgpOgogICAgICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihjYXRlZ29yeV9wYXRoLCBmKQogICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKGZpbGVfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGV4dCA9IG9zLnBhdGguc3BsaXRleHQoZilbMV0ubG93ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICBzeXMuc3RkZXJyLndyaXRlKGYi5paH5Lu2OiB7Zn0sIOaJqeWxleWQjToge2V4dH0sIOWcqOWIl+ihqOS4rToge2V4dCBpbiBhbGxfbWVkaWFfZXh0ZW5zaW9uc31cbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHN5cy5zdGRlcnIuZmx1c2goKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBleHQgaW4gYWxsX21lZGlhX2V4dGVuc2lvbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOiOt+WPluaWh+S7tuS/ruaUueaXtumXtO+8iOS4iuS8oOaXtumXtO+8iQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9zdGF0ID0gb3Muc3RhdChmaWxlX3BhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZF90aW1lID0gZmlsZV9zdGF0LnN0X210aW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg55Sf5oiQ5aqS5L2T5paH5Lu255qEIFVSTO+8iOebuOWvueS6juacjeWKoeWZqOagueebruW9le+8iQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVfcGF0aCA9IG9zLnBhdGgucmVscGF0aChmaWxlX3BhdGgsIFZJREVPX1JPT1QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOagueaNruaWh+S7tuexu+Wei+mAieaLqSBVUkwg5YmN57yACiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxfcHJlZml4ID0gJy9tdXNpYy8nIGlmIGV4dCBpbiBtdXNpY19leHRlbnNpb25zIGVsc2UgJy92aWRlby8nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg5L2/55So5a6M5pW05paH5Lu25ZCN5L2c5Li6dGl0bGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOaehOW7uuWujOaVtOeahFVSTO+8iOS9v+eUqOacjeWKoeWZqElQ77yJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOiOt+WPluacjeWKoeWZqElQ77yI5LuO6K+35rGC5aS05oiW5L2/55So6buY6K6k5YC877yJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJfaG9zdCA9IHNlbGYuaGVhZGVycy5nZXQoJ0hvc3QnLCAnNDcuMjQzLjE3Ny4xNjY6ODA4MScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIOWmguaenEhvc3TmmK9sb2NhbGhvc3TvvIzkvb/nlKjmnI3liqHlmahJUAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2xvY2FsaG9zdCcgaW4gc2VydmVyX2hvc3Qgb3IgJzEyNy4wLjAuMScgaW4gc2VydmVyX2hvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyX2hvc3QgPSAnNDcuMjQzLjE3Ny4xNjY6ODA4MScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICc6JyBub3QgaW4gc2VydmVyX2hvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyX2hvc3QgPSBmIntzZXJ2ZXJfaG9zdH06ODA4MSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg5L2/55SodXJsX3ByZWZpeOaehOW7uuWujOaVtFVSTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF91cmwgPSBmImh0dHA6Ly97c2VydmVyX2hvc3R9e3VybF9wcmVmaXh9e3JlbGF0aXZlX3BhdGgucmVwbGFjZShvcy5zZXAsICcvJyl9IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2xpc3QuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGl0bGUnOiB0aXRsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogZnVsbF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogZiwgICMg5L2/55So5paH5Lu25ZCN5L2c5Li6aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmlsZW5hbWUnOiBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RpZmllZF90aW1lJzogbW9kaWZpZWRfdGltZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZShmIuaJvuWIsCB7bGVuKGZpbGVfbGlzdCl9IOS4quaWh+S7tlxuIikKICAgICAgICAgICAgICAgIHN5cy5zdGRlcnIud3JpdGUoZiJmaWxlX2xpc3TlhoXlrrk6IHtmaWxlX2xpc3R9XG4iKQogICAgICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZShmInZpZGVvc+mVv+W6pu+8iOa3u+WKoOWJje+8iToge2xlbih2aWRlb3MpfVxuIikKICAgICAgICAgICAgICAgIHN5cy5zdGRlcnIuZmx1c2goKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOWwneivleWKoOi9veS/neWtmOeahOaOkuW6j+mhuuW6jwogICAgICAgICAgICAgICAgb3JkZXJfZmlsZSA9IG9zLnBhdGguam9pbihWSURFT19ST09ULCAnLmZpbGVfb3JkZXJzLmpzb24nKQogICAgICAgICAgICAgICAgc2F2ZWRfb3JkZXIgPSBOb25lCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcmRlcl9maWxlKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihvcmRlcl9maWxlLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmRlcnMgPSBqc29uLmxvYWQoZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkX29yZGVyID0gb3JkZXJzLmdldChjYXRlZ29yeSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc2F2ZWRfb3JkZXI6CiAgICAgICAgICAgICAgICAgICAgIyDkvb/nlKjkv53lrZjnmoTmjpLluo/pobrluo8KICAgICAgICAgICAgICAgICAgICBmaWxlX2RpY3QgPSB7aXRlbVsnaWQnXTogaXRlbSBmb3IgaXRlbSBpbiBmaWxlX2xpc3R9CiAgICAgICAgICAgICAgICAgICAgb3JkZXJlZF9saXN0ID0gW10KICAgICAgICAgICAgICAgICAgICBmb3IgZmlsZV9pZCBpbiBzYXZlZF9vcmRlcjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmlsZV9pZCBpbiBmaWxlX2RpY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmRlcmVkX2xpc3QuYXBwZW5kKGZpbGVfZGljdFtmaWxlX2lkXSkKICAgICAgICAgICAgICAgICAgICAjIOa3u+WKoOS4jeWcqOaOkuW6j+WIl+ihqOS4reeahOaWsOaWh+S7tu+8iOaMieS/ruaUueaXtumXtOaOkuW6j++8iQogICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZyA9IFtpdGVtIGZvciBpdGVtIGluIGZpbGVfbGlzdCBpZiBpdGVtWydpZCddIG5vdCBpbiBzYXZlZF9vcmRlcl0KICAgICAgICAgICAgICAgICAgICByZW1haW5pbmcuc29ydChrZXk9bGFtYmRhIHg6IHhbJ21vZGlmaWVkX3RpbWUnXSkKICAgICAgICAgICAgICAgICAgICBvcmRlcmVkX2xpc3QuZXh0ZW5kKHJlbWFpbmluZykKICAgICAgICAgICAgICAgICAgICBmaWxlX2xpc3QgPSBvcmRlcmVkX2xpc3QKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyDkvb/nlKjmmbrog73mjpLluo8KICAgICAgICAgICAgICAgICAgICBkZWYgc21hcnRfc29ydF9rZXkoaXRlbSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gaXRlbVsndGl0bGUnXQogICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZF90aW1lID0gaXRlbVsnbW9kaWZpZWRfdGltZSddCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOaPkOWPluaWh+S7tuWQjeS4reeahOaVsOWtl+W6j+WPt++8iOaUr+aMgeS4reaWh+WSjOmYv+aLieS8r+aVsOWtl++8iQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDlhYjlsJ3or5Xmj5Dlj5bkuK3mlofmlbDlrZfvvIjkuIDjgIHkuozjgIHkuIkuLi4g5oiWIOesrOS4gOOAgeesrOS6jC4uLu+8iQogICAgICAgICAgICAgICAgICAgICAgICBjaGluZXNlX251bXMgPSB7J+S4gCc6IDEsICfkuownOiAyLCAn5LiJJzogMywgJ+Wbmyc6IDQsICfkupQnOiA1LCAn5YWtJzogNiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICfkuIMnOiA3LCAn5YWrJzogOCwgJ+S5nSc6IDksICfljYEnOiAxMCwgJ+eZvic6IDEwMCwgJ+WNgyc6IDEwMDB9CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlfbnVtID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDmn6Xmib4i56ysWCLmiJYi56ysWFgi5qih5byPCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHIn56ysKFvkuIDkuozkuInlm5vkupTlha3kuIPlhavkuZ3ljYHnmb7ljYPkuIdcZF0rKScsIHRpdGxlKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bV9zdHIgPSBtYXRjaC5ncm91cCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDlpoLmnpzmmK/kuK3mlofmlbDlrZfvvIzovazmjaIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG51bV9zdHIgaW4gY2hpbmVzZV9udW1zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlfbnVtID0gY2hpbmVzZV9udW1zW251bV9zdHJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG51bV9zdHIuaXNkaWdpdCgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlfbnVtID0gaW50KG51bV9zdHIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg5bCd6K+V6Kej5p6Q5Lit5paH5pWw5a2X77yI5aaCIuWNgeS6jCLvvIkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW0gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGNoYXIgaW4gbnVtX3N0cjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hhciBpbiBjaGluZXNlX251bXM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGFyID09ICfljYEnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bSA9IDEwIGlmIG51bSA9PSAwIGVsc2UgbnVtICogMTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtICs9IGNoaW5lc2VfbnVtc1tjaGFyXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlfbnVtID0gbnVtIGlmIG51bSA+IDAgZWxzZSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOWmguaenOayoeacieaJvuWIsCLnrKxYIuaooeW8j++8jOafpeaJvuaJgOacieaVsOWtlwogICAgICAgICAgICAgICAgICAgICAgICBpZiBwcmltYXJ5X251bSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVycyA9IHJlLmZpbmRhbGwocidcZCsnLCB0aXRsZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlfbnVtID0gaW50KG51bWJlcnNbMF0pIGlmIG51bWJlcnMgZWxzZSA5OTk5OTkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMg56Gu5L+dIHByaW1hcnlfbnVtIOaYr+aVtOaVsAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeV9udW0gPSBpbnQocHJpbWFyeV9udW0pIGlmIHByaW1hcnlfbnVtIGlzIG5vdCBOb25lIGVsc2UgOTk5OTk5CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIOivvueoi+exu+Wei+aOkuW6j++8mualt+S5piA8IOihjOS5piA8IOe7mOeUuyA8IOWFtuS7lgogICAgICAgICAgICAgICAgICAgICAgICAjIOajgOafpeWFs+mUruWtl++8iOaMieS8mOWFiOe6p++8iQogICAgICAgICAgICAgICAgICAgICAgICBpZiAn5qW35LmmJyBpbiB0aXRsZSBvciAn5qW3JyBpbiB0aXRsZSBvciAn5qW35L2TJyBpbiB0aXRsZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZV90eXBlID0gMQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmICfooYzkuaYnIGluIHRpdGxlIG9yICfooYwnIGluIHRpdGxlIG9yICfooYzkvZMnIGluIHRpdGxlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlX3R5cGUgPSAyCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgJ+e7mOeUuycgaW4gdGl0bGUgb3IgJ+eUuycgaW4gdGl0bGUgb3IgJ+e+juacrycgaW4gdGl0bGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VfdHlwZSA9IDMKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZV90eXBlID0gNAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDmjpLluo/plK7vvJoo6K++56iL57G75Z6LLCDluo/lj7csIOS/ruaUueaXtumXtCkKICAgICAgICAgICAgICAgICAgICAgICAgIyDkv67mlLnml7bpl7TlsI/nmoTvvIjml6nnmoTvvInmjpLlnKjliY3pnaLvvIzmlrDkuIrkvKDnmoTmjpLlnKjlkI7pnaIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChjb3Vyc2VfdHlwZSwgcHJpbWFyeV9udW0sIG1vZGlmaWVkX3RpbWUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDlr7nmlofku7bliJfooajov5vooYzmjpLluo8KICAgICAgICAgICAgICAgICAgICBmaWxlX2xpc3Quc29ydChrZXk9c21hcnRfc29ydF9rZXkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5p6E5bu66L+U5Zue57uT5p6c77yI5Y675o6J5Li05pe25a2X5q6177yJCiAgICAgICAgICAgICAgICBmb3IgaXRlbSBpbiBmaWxlX2xpc3Q6CiAgICAgICAgICAgICAgICAgICAgdmlkZW9zLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICd0aXRsZSc6IGl0ZW1bJ3RpdGxlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICd1cmwnOiBpdGVtWyd1cmwnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogaXRlbVsnaWQnXQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBzeXMuc3RkZXJyLndyaXRlKGYidmlkZW9z6ZW/5bqm77yI5re75Yqg5ZCO77yJOiB7bGVuKHZpZGVvcyl9XG4iKQogICAgICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZShmInZpZGVvc+WGheWuuToge3ZpZGVvc31cbiIpCiAgICAgICAgICAgICAgICBzeXMuc3RkZXJyLmZsdXNoKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHN5cy5zdGRlcnIud3JpdGUoZiLnm67lvZXkuI3lrZjlnKg6IHtjYXRlZ29yeV9wYXRofVxuIikKICAgICAgICAgICAgICAgIHN5cy5zdGRlcnIuZmx1c2goKQogICAgICAgICAgICAKICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZShmIuacgOe7iOi/lOWbnnZpZGVvc+mVv+W6pjoge2xlbih2aWRlb3MpfVxuIikKICAgICAgICAgICAgc3lzLnN0ZGVyci5mbHVzaCgpCiAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoanNvbi5kdW1wcyh2aWRlb3MsIGVuc3VyZV9hc2NpaT1GYWxzZSkuZW5jb2RlKCd1dGYtOCcpKQogICAgICAgICAgICAKICAgICAgICBlbGlmIHNlbGYucGF0aC5zdGFydHN3aXRoKCcvdmlkZW8vJykgb3Igc2VsZi5wYXRoLnN0YXJ0c3dpdGgoJy9tdXNpYy8nKToKICAgICAgICAgICAgIyDmj5Dkvpvop4bpopHmiJbpn7PkuZDmlofku7bmtYEKICAgICAgICAgICAgbWVkaWFfcGF0aCA9IHNlbGYucGF0aC5yZXBsYWNlKCcvdmlkZW8vJywgJycpLnJlcGxhY2UoJy9tdXNpYy8nLCAnJykKICAgICAgICAgICAgZnVsbF9wYXRoID0gb3MucGF0aC5qb2luKFZJREVPX1JPT1QsIHVucXVvdGUobWVkaWFfcGF0aCkpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmdWxsX3BhdGgpIGFuZCBvcy5wYXRoLmlzZmlsZShmdWxsX3BhdGgpOgogICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgICAgICMg5pSv5oyB5aqS5L2T5paH5Lu25rWB5byP5Lyg6L6TCiAgICAgICAgICAgICAgICBleHQgPSBvcy5wYXRoLnNwbGl0ZXh0KGZ1bGxfcGF0aClbMV0ubG93ZXIoKQogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gewogICAgICAgICAgICAgICAgICAgICMg6KeG6aKR5qC85byPCiAgICAgICAgICAgICAgICAgICAgJy5tcDQnOiAndmlkZW8vbXA0JywKICAgICAgICAgICAgICAgICAgICAnLm1vdic6ICd2aWRlby9xdWlja3RpbWUnLAogICAgICAgICAgICAgICAgICAgICcubWt2JzogJ3ZpZGVvL3gtbWF0cm9za2EnLAogICAgICAgICAgICAgICAgICAgICcuYXZpJzogJ3ZpZGVvL3gtbXN2aWRlbycsCiAgICAgICAgICAgICAgICAgICAgJy5ybXZiJzogJ3ZpZGVvL3ZuZC5ybi1yZWFsdmlkZW8nLAogICAgICAgICAgICAgICAgICAgICcucm0nOiAndmlkZW8vdm5kLnJuLXJlYWx2aWRlbycsCiAgICAgICAgICAgICAgICAgICAgJy53bXYnOiAndmlkZW8veC1tcy13bXYnLAogICAgICAgICAgICAgICAgICAgICcuZmx2JzogJ3ZpZGVvL3gtZmx2JywKICAgICAgICAgICAgICAgICAgICAnLmY0dic6ICd2aWRlby94LWY0dicsCiAgICAgICAgICAgICAgICAgICAgJy5tNHYnOiAndmlkZW8veC1tNHYnLAogICAgICAgICAgICAgICAgICAgICcubXBnJzogJ3ZpZGVvL21wZWcnLAogICAgICAgICAgICAgICAgICAgICcubXBlZyc6ICd2aWRlby9tcGVnJywKICAgICAgICAgICAgICAgICAgICAnLjNncCc6ICd2aWRlby8zZ3BwJywKICAgICAgICAgICAgICAgICAgICAnLndlYm0nOiAndmlkZW8vd2VibScsCiAgICAgICAgICAgICAgICAgICAgJy50cyc6ICd2aWRlby9tcDJ0JywKICAgICAgICAgICAgICAgICAgICAnLm10cyc6ICd2aWRlby9tcDJ0JywKICAgICAgICAgICAgICAgICAgICAnLnZvYic6ICd2aWRlby9kdmQnLAogICAgICAgICAgICAgICAgICAgICcuZGl2eCc6ICd2aWRlby94LWRpdngnLAogICAgICAgICAgICAgICAgICAgICcueHZpZCc6ICd2aWRlby94LWRpdngnLAogICAgICAgICAgICAgICAgICAgICMg6Z+z5LmQ5qC85byPCiAgICAgICAgICAgICAgICAgICAgJy5tcDMnOiAnYXVkaW8vbXBlZycsCiAgICAgICAgICAgICAgICAgICAgJy5tNGEnOiAnYXVkaW8vbXA0JywKICAgICAgICAgICAgICAgICAgICAnLmZsYWMnOiAnYXVkaW8vZmxhYycsCiAgICAgICAgICAgICAgICAgICAgJy53YXYnOiAnYXVkaW8vd2F2JywKICAgICAgICAgICAgICAgICAgICAnLmFhYyc6ICdhdWRpby9hYWMnLAogICAgICAgICAgICAgICAgICAgICcub2dnJzogJ2F1ZGlvL29nZycsCiAgICAgICAgICAgICAgICAgICAgJy53bWEnOiAnYXVkaW8veC1tcy13bWEnLAogICAgICAgICAgICAgICAgfS5nZXQoZXh0LCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJykKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtdHlwZScsIGNvbnRlbnRfdHlwZSkKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0FjY2VwdC1SYW5nZXMnLCAnYnl0ZXMnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIOaUr+aMgeiMg+WbtOivt+axgu+8iOinhumikS/pn7PpopHmi5bliqjvvIkKICAgICAgICAgICAgICAgIHJhbmdlX2hlYWRlciA9IHNlbGYuaGVhZGVycy5nZXQoJ1JhbmdlJywgJycpCiAgICAgICAgICAgICAgICBmaWxlX3NpemUgPSBvcy5wYXRoLmdldHNpemUoZnVsbF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiByYW5nZV9oZWFkZXI6CiAgICAgICAgICAgICAgICAgICAgIyDop6PmnpDojIPlm7Tor7fmsYIKICAgICAgICAgICAgICAgICAgICByYW5nZV9tYXRjaCA9IHJhbmdlX2hlYWRlci5yZXBsYWNlKCdieXRlcz0nLCAnJykuc3BsaXQoJy0nKQogICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaW50KHJhbmdlX21hdGNoWzBdKSBpZiByYW5nZV9tYXRjaFswXSBlbHNlIDAKICAgICAgICAgICAgICAgICAgICBlbmQgPSBpbnQocmFuZ2VfbWF0Y2hbMV0pIGlmIHJhbmdlX21hdGNoWzFdIGVsc2UgZmlsZV9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDYpICAjIFBhcnRpYWwgQ29udGVudAogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtUmFuZ2UnLCBmJ2J5dGVzIHtzdGFydH0te2VuZH0ve2ZpbGVfc2l6ZX0nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtTGVuZ3RoJywgc3RyKGVuZCAtIHN0YXJ0ICsgMSkpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZ1bGxfcGF0aCwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgZi5zZWVrKHN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLndmaWxlLndyaXRlKGYucmVhZChlbmQgLSBzdGFydCArIDEpKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIOWujOaVtOaWh+S7tgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtTGVuZ3RoJywgc3RyKGZpbGVfc2l6ZSkpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZ1bGxfcGF0aCwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi53ZmlsZS53cml0ZShmLnJlYWQoKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDQsICJGaWxlIG5vdCBmb3VuZCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyDov5Tlm57nroDljZXnmoQgSFRNTCDor7TmmI7pobXpnaIKICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAgICAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC10eXBlJywgJ3RleHQvaHRtbDsgY2hhcnNldD11dGYtOCcpCiAgICAgICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICBodG1sID0gZiIiIgogICAgICAgICAgICA8aHRtbD4KICAgICAgICAgICAgPGhlYWQ+PHRpdGxlPuinhumikeacjeWKoeWZqDwvdGl0bGU+PC9oZWFkPgogICAgICAgICAgICA8Ym9keT4KICAgICAgICAgICAgICAgIDxoMT7op4bpopHmnI3liqHlmajov5DooYzkuK08L2gxPgogICAgICAgICAgICAgICAgPHA+5pyN5Yqh5Zmo56uv5Y+jOiB7UE9SVH08L3A+CiAgICAgICAgICAgICAgICA8cD7op4bpopHmoLnnm67lvZU6IHtWSURFT19ST09UfTwvcD4KICAgICAgICAgICAgICAgIDxwPkFQSSDnq6/ngrk6PC9wPgogICAgICAgICAgICAgICAgPHVsPgogICAgICAgICAgICAgICAgICAgIDxsaT48YSBocmVmPSIvYXBpL2NhdGVnb3JpZXMiPi9hcGkvY2F0ZWdvcmllczwvYT4gLSDojrflj5bliIbnsbvliJfooag8L2xpPgogICAgICAgICAgICAgICAgICAgIDxsaT4vYXBpL2xpc3Qv5YiG57G75ZCNIC0g6I635Y+W5p+Q5Liq5YiG57G75LiL55qE6KeG6aKR5YiX6KGoPC9saT4KICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgIDwvYm9keT4KICAgICAgICAgICAgPC9odG1sPgogICAgICAgICAgICAiIiIKICAgICAgICAgICAgc2VsZi53ZmlsZS53cml0ZShodG1sLmVuY29kZSgndXRmLTgnKSkKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgIyDkv67mlLnov5nph4znmoTot6/lvoTkuLrkvaDlrp7pmYXnmoTop4bpopHmoLnnm67lvZUKICAgIGlmIGxlbihvcy5zeXMuYXJndikgPiAxOgogICAgICAgIFZJREVPX1JPT1QgPSBvcy5zeXMuYXJndlsxXQogICAgCiAgICAjIOiOt+WPluacrOacuiBJUCDlnLDlnYAKICAgIGltcG9ydCBzb2NrZXQKICAgIHRyeToKICAgICAgICBzID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfREdSQU0pCiAgICAgICAgcy5jb25uZWN0KCgiOC44LjguOCIsIDgwKSkKICAgICAgICBsb2NhbF9pcCA9IHMuZ2V0c29ja25hbWUoKVswXQogICAgICAgIHMuY2xvc2UoKQogICAgZXhjZXB0OgogICAgICAgIGxvY2FsX2lwID0gIjE5Mi4xNjguMS4xMDAiICAjIOm7mOiupElQCiAgICAKICAgIHByaW50KGYi5ZCv5Yqo6KeG6aKR5pyN5Yqh5ZmoLi4uIikKICAgIHByaW50KGYi56uv5Y+jOiB7UE9SVH0iKQogICAgcHJpbnQoZiLop4bpopHmoLnnm67lvZU6IHtWSURFT19ST09UfSIpCiAgICBwcmludChmIlxu6K6/6ZeuIGh0dHA6Ly9sb2NhbGhvc3Q6e1BPUlR9IOafpeeci+acjeWKoeWZqOeKtuaAgSIpCiAgICBwcmludChmIuWcqCBGbHV0dGVyIEFwcCDkuK3ovpPlhaXmnI3liqHlmajlnLDlnYA6IGh0dHA6Ly97bG9jYWxfaXB9OntQT1JUfSIpCiAgICBwcmludChmIlxu5oyJIEN0cmwrQyDlgZzmraLmnI3liqHlmagiKQogICAgCiAgICB3aXRoIHNvY2tldHNlcnZlci5UQ1BTZXJ2ZXIoKCIiLCBQT1JUKSwgVmlkZW9IYW5kbGVyKSBhcyBodHRwZDoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGh0dHBkLnNlcnZlX2ZvcmV2ZXIoKQogICAgICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICAgICAgcHJpbnQoIlxu5pyN5Yqh5Zmo5bey5YGc5q2iIikKCg=="""

# 创建目录
os.makedirs('/root/video_server', exist_ok=True)

# 解码并写入文件
content = base64.b64decode(encoded_content).decode('utf-8')

# 修改 VIDEO_ROOT 为 /root/videos
content = content.replace('VIDEO_ROOT = "/Volumes/Expansion"', 'VIDEO_ROOT = "/root/videos"')

# 修改服务器IP为北京服务器IP
content = content.replace('47.243.177.166:8081', '39.107.137.136:8081')

with open('/root/video_server/video_server.py', 'w', encoding='utf-8') as f:
    f.write(content)

# 设置执行权限
os.chmod('/root/video_server/video_server.py', 0o755)

print("✓ video_server.py 创建成功！")
print("✓ 已配置 VIDEO_ROOT = /root/videos")
print("✓ 已配置服务器IP = 39.107.137.136:8081")
print("\n文件位置: /root/video_server/video_server.py")
