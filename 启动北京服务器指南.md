# 🚀 启动北京服务器指南

## 📋 服务器信息
- **IP地址**: 39.107.137.136
- **端口**: 8081
- **状态**: 服务器可达，但 8081 端口未响应

## 🔍 问题诊断

### 当前状态
- ✅ 服务器可以 ping 通（网络连接正常）
- ❌ 8081 端口无法连接（服务未运行或端口未开放）

## 🔧 解决步骤

### 步骤1：连接到北京服务器

使用以下方式之一连接：

#### 方式1：阿里云 Workbench（推荐）
1. 登录阿里云控制台
2. 进入 ECS 实例管理
3. 找到实例：`8336ddd8dbe0433ea562a4b6e5f91da6`
4. 点击"远程连接" → "Workbench远程连接"

#### 方式2：SSH
```bash
ssh root@39.107.137.136
# 或使用你的用户名
ssh ubuntu@39.107.137.136
```

### 步骤2：检查服务器状态

连接后执行以下命令：

```bash
# 1. 检查 video_server.py 是否在运行
ps aux | grep video_server.py

# 2. 检查 8081 端口是否被监听
netstat -tlnp | grep 8081
# 或
ss -tlnp | grep 8081

# 3. 检查防火墙状态
sudo ufw status
# 或
sudo firewall-cmd --list-all
```

### 步骤3：检查视频目录

```bash
# 检查视频根目录
echo $VIDEO_ROOT

# 检查视频文件是否存在
ls -la /root/videos/原创视频
ls -la /root/videos/原创歌曲

# 如果目录不存在，创建它
mkdir -p /root/videos/原创视频
mkdir -p /root/videos/原创歌曲
```

### 步骤4：启动服务器

#### 如果 video_server.py 存在

```bash
# 1. 设置视频根目录
export VIDEO_ROOT="/root/videos"

# 2. 进入脚本目录（根据实际情况调整）
cd /root/app  # 或 video_server.py 所在目录

# 3. 启动服务器（前台运行，用于测试）
python3 video_server.py

# 4. 如果测试成功，使用后台运行
nohup python3 video_server.py > server.log 2>&1 &
```

#### 如果 video_server.py 不存在

需要先上传 `video_server.py` 到服务器：

```bash
# 在本地 Mac 执行（从项目目录）
scp video_server.py root@39.107.137.136:/root/app/
```

### 步骤5：开放防火墙端口

如果防火墙阻止了 8081 端口：

```bash
# Ubuntu/Debian
sudo ufw allow 8081/tcp
sudo ufw reload

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=8081/tcp
sudo firewall-cmd --reload
```

### 步骤6：检查阿里云安全组

1. 登录阿里云控制台
2. 进入 ECS 实例 → 安全组
3. 添加入站规则：
   - 端口：8081
   - 协议：TCP
   - 授权对象：0.0.0.0/0（或你的 IP）

### 步骤7：测试服务器

在服务器上测试：

```bash
# 测试本地连接
curl http://localhost:8081/api/categories
curl http://localhost:8081/api/list/原创视频
```

在本地 Mac 测试：

```bash
curl http://39.107.137.136:8081/api/categories
```

## 📝 快速启动脚本

如果服务器上已有 `video_server.py`，可以使用以下脚本：

```bash
#!/bin/bash
# 启动视频服务器

export VIDEO_ROOT="/root/videos"
cd /root/app  # 或脚本所在目录

# 停止旧进程（如果存在）
pkill -f video_server.py

# 启动新进程
nohup python3 video_server.py > /root/server.log 2>&1 &

echo "服务器已启动，日志文件: /root/server.log"
echo "检查状态: ps aux | grep video_server.py"
echo "查看日志: tail -f /root/server.log"
```

## ✅ 验证清单

- [ ] 服务器可以 ping 通
- [ ] video_server.py 正在运行
- [ ] 8081 端口正在监听
- [ ] 防火墙已开放 8081 端口
- [ ] 阿里云安全组已配置
- [ ] 本地可以访问 API
- [ ] 应用可以连接服务器

## 🔗 相关文件

- `video_server.py` - 视频服务器脚本
- `检查北京服务器状态.md` - 详细检查步骤


