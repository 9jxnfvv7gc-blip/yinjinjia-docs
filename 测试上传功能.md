# 🎯 测试上传功能 - 快速指南

## ✅ 第一步：启动应用

### 在终端运行：
```bash
cd /Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905
flutter run -d ios
```

**等待应用启动完成**（看到Simulator打开应用）

---

## ✅ 第二步：启动本地服务器（新终端窗口）

### 打开新的终端窗口（保持应用运行的终端不动）

### 运行服务器：
```bash
cd /Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905

# 创建一个测试目录（如果还没有）
mkdir -p /tmp/test_media

# 启动服务器
python3 video_server.py "/tmp/test_media"
```

### 应该看到：
```
服务器已启动在 http://0.0.0.0:8081
```

**⚠️ 重要：保持这个终端窗口打开！服务器需要一直运行。**

---

## ✅ 第三步：在应用中测试上传

### 1. 检查上传按钮
- 在Simulator中的应用界面
- 应该看到绿色的 **"上传新内容"** 按钮
- 如果看不到，说明管理员模式未启用（需要检查 `lib/config.dart`）

### 2. 点击上传按钮
- 点击绿色的 **"上传新内容"** 按钮
- 应该弹出底部菜单，显示：
  - 📹 **上传视频**
  - 🎵 **上传音乐**

### 3. 选择"上传音乐"
- 点击 **"上传音乐"**
- 会打开文件选择器

### 4. 选择MP3文件
- 在文件选择器中选择一个MP3文件
- 任何MP3文件都可以（测试用）

### 5. 等待上传
- 显示上传进度（转圈动画）
- 等待上传完成

### 6. 查看结果
- ✅ **成功**：显示绿色的 **"上传成功！"** 提示
- ❌ **失败**：显示红色的错误信息

---

## ⚠️ 常见问题

### 问题1：看不到上传按钮

**原因**：管理员模式未启用

**解决**：
1. 打开文件：`lib/config.dart`
2. 找到这一行：
   ```dart
   static bool get isAdmin {
     return true; // 确保这里是 true
   }
   ```
3. 保存文件
4. 在运行应用的终端按 `r`（热重载）

---

### 问题2：上传失败 - "连接服务器失败" 或 "Connection refused"

**原因**：服务器未启动

**解决**：
1. 检查服务器是否在运行（看第二个终端窗口）
2. 如果没有运行，重新启动服务器（见第二步）
3. 确保服务器显示 "服务器已启动在 http://0.0.0.0:8081"

---

### 问题3：上传失败 - "HTTP 404" 或 "HTTP 500"

**原因**：服务器API路径不对

**解决**：
1. 检查 `lib/config.dart` 中的服务器地址
2. 确保是：`http://localhost:8081`
3. 检查服务器终端是否有错误信息

---

### 问题4：文件选择器没有打开

**原因**：iOS权限问题

**解决**：
1. 在Simulator中，确保应用有文件访问权限
2. 如果还是不行，尝试重启应用

---

## 📋 测试检查清单

### 上传前
- [ ] 应用正在运行（Simulator中能看到应用）
- [ ] 能看到绿色的"上传新内容"按钮
- [ ] 本地服务器已启动（第二个终端显示"服务器已启动"）
- [ ] 服务器地址是 `http://localhost:8081`

### 上传中
- [ ] 能打开文件选择器
- [ ] 能选择MP3文件
- [ ] 显示上传进度（转圈动画）

### 上传后
- [ ] 显示成功或失败提示
- [ ] 如果成功，列表应该自动刷新
- [ ] 能看到新上传的音乐在列表中

---

## 🚀 快速测试（3步）

### 1️⃣ 启动应用
```bash
cd /Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905
flutter run -d ios
```

### 2️⃣ 启动服务器（新终端）
```bash
cd /Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905
python3 video_server.py "/tmp/test_media"
```

### 3️⃣ 在应用中测试
- 点击"上传新内容" → 选择"上传音乐" → 选择MP3文件

---

## 💡 提示

1. **需要两个终端窗口**：
   - 终端1：运行Flutter应用（`flutter run`）
   - 终端2：运行Python服务器（`python3 video_server.py`）

2. **服务器必须一直运行**：
   - 上传时需要服务器接收文件
   - 不要关闭服务器终端窗口

3. **测试文件**：
   - 可以使用任何MP3文件
   - 建议使用小文件（<10MB）先测试

4. **如果应用卡住**：
   - 在运行应用的终端按 `r` 热重载
   - 或按 `R` 完全重启

---

## ❓ 如果还是不行

告诉我：
1. ✅ 能看到上传按钮吗？
2. ✅ 点击上传按钮后发生了什么？
3. ✅ 有什么错误信息？（截图或复制错误信息）
4. ✅ 服务器是否正在运行？

我会帮你解决！

