# 上传修改后的文件并测试

## ✅ 已完成

- ✅ 已修改代码，使用sys.stderr.write确保输出到日志
- ✅ 添加了更多调试信息
- ⏳ 需要上传到服务器并测试

---

## 📤 上传方法

### 方法1：使用Workbench文件管理器

1. 打开Workbench文件管理器
2. 导航到 `/root/video_server/`
3. 上传本地的 `video_server.py` 文件

---

### 方法2：使用scp（如果SSH可用）

在你的Mac终端执行：

```bash
scp "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905/video_server.py" root@47.243.177.166:/root/video_server/
```

---

### 方法3：直接在服务器上修改（如果上传困难）

在Workbench终端执行：

```bash
# 停止后台服务器
pkill -f video_server.py

# 停止systemd服务
systemctl stop video-server

# 备份文件
cp /root/video_server/video_server.py /root/video_server/video_server.py.bak9

# 修改代码（添加import sys和修改print为sys.stderr.write）
# 这个比较复杂，建议使用方法1或方法2上传文件
```

---

## 🧪 测试步骤

### 步骤1：上传文件后，停止后台服务器

```bash
pkill -f video_server.py
```

---

### 步骤2：重新后台运行服务器

```bash
cd /root/video_server
python3 video_server.py > /tmp/video_server.log 2>&1 &
sleep 2
```

---

### 步骤3：访问API

```bash
curl http://localhost:8081/api/list/原创视频
```

---

### 步骤4：查看调试信息

```bash
cat /tmp/video_server.log
```

**应该看到**：
- `API列表请求: category=原创视频, category_path=/root/videos/原创视频`
- `VIDEO_ROOT: /root/videos`
- `路径存在: True`
- `目录存在，开始扫描文件...`
- `文件: 1.mp4, 扩展名: .mp4, 在列表中: True`
- `找到 X 个文件`
- `file_list内容: [...]`
- `videos长度（添加前）: 0`
- `videos长度（添加后）: X`
- `videos内容: [...]`
- `最终返回videos长度: X`

---

## 🎯 现在可以执行

1. **上传修改后的文件**（使用Workbench文件管理器或scp）
2. **停止后台服务器**（`pkill -f video_server.py`）
3. **重新后台运行**（`python3 video_server.py > /tmp/video_server.log 2>&1 &`）
4. **访问API**（`curl http://localhost:8081/api/list/原创视频`）
5. **查看调试信息**（`cat /tmp/video_server.log`）

---

**先上传文件，然后重新测试！** 📤

