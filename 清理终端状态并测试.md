# æ¸…ç†ç»ˆç«¯çŠ¶æ€å¹¶æµ‹è¯•

## ðŸ›‘ æ­¥éª¤1ï¼šæ¸…ç†ç»ˆç«¯çŠ¶æ€

### å¦‚æžœç»ˆç«¯æ˜¾ç¤º `>` æç¤ºç¬¦ï¼ˆè¿˜åœ¨ç­‰å¾…è¾“å…¥ï¼‰

æŒ‰ `Ctrl+C` é€€å‡ºå½“å‰çŠ¶æ€ï¼Œç›´åˆ°çœ‹åˆ°æ­£å¸¸çš„å‘½ä»¤æç¤ºç¬¦ï¼š

```
root@iZj6cg78ov73x6cxbephc1Z:~/video_server#
```

---

### å¦‚æžœåŽå°æœ‰æœåŠ¡å™¨åœ¨è¿è¡Œ

```bash
# åœæ­¢åŽå°æœåŠ¡å™¨
pkill -f video_server.py

# åœæ­¢systemdæœåŠ¡
systemctl stop video-server
```

---

## âœ… æ­¥éª¤2ï¼šç¡®è®¤ç»ˆç«¯çŠ¶æ€

ç»ˆç«¯åº”è¯¥æ˜¾ç¤ºæ­£å¸¸çš„å‘½ä»¤æç¤ºç¬¦ï¼Œå¯ä»¥è¾“å…¥æ–°å‘½ä»¤ã€‚

---

## ðŸš€ æ­¥éª¤3ï¼šåˆ›å»ºå¹¶è¿è¡Œæµ‹è¯•è„šæœ¬

### åˆ›å»ºæµ‹è¯•è„šæœ¬

```bash
cat > /tmp/test_api_logic.py << 'ENDOFFILE'
#!/usr/bin/env python3
import os
import json

VIDEO_ROOT = '/root/videos'
category = 'åŽŸåˆ›è§†é¢‘'
category_path = os.path.join(VIDEO_ROOT, category)

print(f"category_path: {category_path}")
print(f"è·¯å¾„å­˜åœ¨: {os.path.exists(category_path)}")

videos = []
file_list = []

if os.path.exists(category_path):
    print("ç›®å½•å­˜åœ¨ï¼Œå¼€å§‹æ‰«ææ–‡ä»¶...")
    
    video_extensions = ['.mp4', '.mov', '.mkv', '.avi', '.flv', '.wmv', '.webm']
    audio_extensions = ['.mp3', '.wav', '.flac', '.aac', '.m4a', '.ogg', '.wma']
    all_media_extensions = video_extensions + audio_extensions
    
    files = os.listdir(category_path)
    print(f"æ–‡ä»¶æ•°é‡: {len(files)}")
    
    for f in files:
        file_path = os.path.join(category_path, f)
        if os.path.isfile(file_path):
            ext = os.path.splitext(f)[1].lower()
            print(f"æ–‡ä»¶: {f}, æ‰©å±•å: {ext}, åœ¨åˆ—è¡¨ä¸­: {ext in all_media_extensions}")
            
            if ext in all_media_extensions:
                relative_path = os.path.relpath(file_path, VIDEO_ROOT)
                url = f"http://47.243.177.166:8081/{relative_path.replace(os.sep, '/')}"
                
                file_list.append({
                    'title': f,
                    'url': url,
                    'id': f
                })
                print(f"  æ·»åŠ åˆ°file_list: {f}")
    
    print(f"file_listé•¿åº¦: {len(file_list)}")
    print(f"file_listå†…å®¹: {file_list}")
    
    for item in file_list:
        videos.append({
            'title': item['title'],
            'url': item['url'],
            'id': item['id']
        })
    
    print(f"videosé•¿åº¦: {len(videos)}")
    print(f"videoså†…å®¹: {videos}")
    
    result = json.dumps(videos, ensure_ascii=False)
    print(f"JSONç»“æžœ: {result}")
else:
    print(f"ç›®å½•ä¸å­˜åœ¨: {category_path}")
ENDOFFILE
```

---

### è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
python3 /tmp/test_api_logic.py
```

---

## ðŸ“‹ æ‰§è¡Œé¡ºåº

1. **æŒ‰ `Ctrl+C`**ï¼ˆå¦‚æžœç»ˆç«¯æ˜¾ç¤º `>` æç¤ºç¬¦ï¼‰
2. **ç¡®è®¤çœ‹åˆ°æ­£å¸¸çš„å‘½ä»¤æç¤ºç¬¦**
3. **æ‰§è¡Œåˆ›å»ºæµ‹è¯•è„šæœ¬çš„å‘½ä»¤**ï¼ˆä¸Šé¢çš„ `cat > /tmp/test_api_logic.py << 'ENDOFFILE'` ...ï¼‰
4. **æ‰§è¡Œè¿è¡Œæµ‹è¯•è„šæœ¬çš„å‘½ä»¤**ï¼ˆ`python3 /tmp/test_api_logic.py`ï¼‰
5. **æŠŠè¾“å‡ºç»“æžœå‘ç»™æˆ‘**

---

**å…ˆæŒ‰ `Ctrl+C` æ¸…ç†ç»ˆç«¯çŠ¶æ€ï¼Œç„¶åŽæ‰§è¡Œæµ‹è¯•ï¼** ðŸ”

