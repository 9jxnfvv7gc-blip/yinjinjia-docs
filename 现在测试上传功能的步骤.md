# 现在测试上传功能的步骤

## 🎯 你的目标
测试上传MP3歌曲功能

---

## ✅ 第一步：确保应用正在运行

### 检查应用是否在运行
- 在Simulator中应该能看到应用界面
- 如果应用没有运行，运行：
  ```bash
  cd /Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905
  flutter run -d ios
  ```

---

## ✅ 第二步：检查上传按钮是否可见

### 在应用中查看
- 应该看到绿色的"上传新内容"按钮
- 如果看不到，说明管理员模式未启用

### 如果看不到上传按钮

**方法1：在代码中修改**（推荐）
1. 打开文件：`lib/config.dart`
2. 找到这一行：
   ```dart
   static bool get isAdmin {
     return true; // 确保这里是true
   }
   ```
3. 保存文件
4. 在终端按 `r`（热重载）

**方法2：检查配置**
- 确保 `enableAdminMode = true`
- 确保 `isAdmin` 返回 `true`

---

## ✅ 第三步：启动本地服务器（测试用）

### 为什么需要服务器？
- 上传功能需要服务器接收文件
- 没有服务器，上传会失败

### 启动服务器

1. **打开新终端窗口**（保持应用运行的终端不动）

2. **运行服务器**：
   ```bash
   cd /Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905
   python3 video_server.py "/Volumes/Expansion/MV【1.62GB】"
   ```
   
   **注意**：如果没有这个目录，可以：
   - 创建一个测试目录：`mkdir -p /tmp/test_media`
   - 使用：`python3 video_server.py "/tmp/test_media"`

3. **等待看到**：
   ```
   服务器已启动在 http://0.0.0.0:8081
   ```

4. **保持这个终端窗口打开**（服务器需要一直运行）

---

## ✅ 第四步：测试上传功能

### 在Simulator中的应用

1. **点击绿色的"上传新内容"按钮**
   - 应该弹出底部菜单
   - 显示"上传视频"和"上传音乐"

2. **选择"上传音乐"**

3. **选择MP3文件**
   - 会打开文件选择器
   - 选择一个MP3文件（任何MP3都可以，测试用）

4. **等待上传**
   - 显示上传进度（转圈）
   - 等待上传完成

5. **查看结果**
   - 如果成功：显示"上传成功！"绿色提示
   - 如果失败：显示错误信息（红色提示）

---

## ⚠️ 可能遇到的问题

### 问题1：看不到上传按钮

**解决**：
1. 检查 `lib/config.dart` 中 `isAdmin = true`
2. 保存文件
3. 在终端按 `r`（热重载）

---

### 问题2：上传失败 - "连接服务器失败"

**原因**：服务器未启动

**解决**：
1. 启动本地服务器（见第三步）
2. 确保服务器正在运行
3. 重新尝试上传

---

### 问题3：上传失败 - "HTTP 404" 或 "HTTP 500"

**原因**：服务器路径或API不对

**解决**：
1. 检查服务器是否正常启动
2. 检查 `lib/config.dart` 中的服务器地址
3. 确保是 `http://localhost:8081`

---

### 问题4：文件选择器没有打开

**原因**：iOS权限问题

**解决**：
1. 检查iOS权限设置
2. 确保应用有文件访问权限

---

## 📋 测试检查清单

### 上传前
- [ ] 应用正在运行
- [ ] 能看到"上传新内容"按钮
- [ ] 本地服务器已启动
- [ ] 服务器显示"已启动"消息

### 上传中
- [ ] 能打开文件选择器
- [ ] 能选择MP3文件
- [ ] 显示上传进度

### 上传后
- [ ] 显示成功或失败提示
- [ ] 如果成功，列表应该刷新
- [ ] 能看到新上传的音乐

---

## 🚀 快速开始（3步）

### 1. 启动服务器（新终端窗口）
```bash
cd /Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905
python3 video_server.py "/tmp/test_media"
```

### 2. 确保应用运行中
- 在Simulator中应该看到应用

### 3. 测试上传
- 点击"上传新内容"
- 选择"上传音乐"
- 选择MP3文件

---

## 💡 提示

1. **需要两个终端窗口**：
   - 一个运行Flutter应用
   - 一个运行Python服务器

2. **服务器必须一直运行**：
   - 上传时需要服务器接收文件
   - 不要关闭服务器终端

3. **测试文件**：
   - 可以使用任何MP3文件
   - 建议使用小文件（<10MB）测试

---

## ❓ 如果还是不行

告诉我：
1. 能看到上传按钮吗？
2. 点击上传按钮后发生了什么？
3. 有什么错误信息？

我会帮你解决！

