# 视频播放黑屏问题排查

## ❌ 问题描述

点击视频后，播放器显示黑屏，看不到视频内容。

---

## ✅ 已修复内容

### 1. 改进错误处理
- 添加了详细的调试信息
- 显示加载状态
- 显示更详细的错误信息
- 处理播放器错误状态

### 2. 改进UI显示
- 显示加载提示
- 显示错误信息（如果有）
- 显示视频路径（用于调试）

---

## 🔍 排查步骤

### 步骤1：查看终端输出

运行应用时，终端会显示调试信息：
- `视频播放器初始化，路径: ...`
- `使用网络URL播放: ...` 或 `使用本地文件播放: ...`
- `视频初始化成功` 或 `视频初始化失败: ...`

**请告诉我终端显示了什么信息！**

---

### 步骤2：检查视频URL

在应用中：
1. 点击视频卡片
2. 如果显示错误信息，查看错误信息中的路径
3. 检查路径格式是否正确

**正确的URL格式应该是**：
- `http://localhost:8081/video/原创视频/文件名.mp4`

---

### 步骤3：检查服务器是否运行

确保 `video_server.py` 正在运行：
```bash
# 检查服务器进程
ps aux | grep video_server.py | grep -v grep
```

如果服务器没有运行，启动它：
```bash
cd "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905"
python3 video_server.py
```

---

### 步骤4：测试视频URL

在浏览器中测试视频URL：
1. 打开浏览器
2. 访问：`http://localhost:8081/video/原创视频/你的视频文件名.mp4`
3. 如果浏览器能播放，说明服务器正常
4. 如果浏览器不能播放，检查：
   - 视频文件是否存在
   - 视频文件格式是否支持
   - 服务器日志是否有错误

---

### 步骤5：检查视频文件

```bash
# 检查视频文件是否存在
ls -la "/Volumes/Expansion/原创视频"

# 检查视频文件格式
file "/Volumes/Expansion/原创视频/你的视频文件名.mp4"
```

---

## 🎯 常见原因和解决方案

### 原因1：视频格式不支持

**macOS上的video_player插件可能不支持某些格式**

**支持的格式**：
- ✅ MP4 (H.264)
- ✅ MOV
- ✅ M4V
- ❌ MKV（可能不支持）
- ❌ AVI（可能不支持）
- ❌ RMVB（不支持）

**解决方法**：
- 将视频转换为MP4格式
- 或使用其他视频格式

---

### 原因2：视频URL不正确

**检查URL格式**：
- ✅ 正确：`http://localhost:8081/video/原创视频/文件名.mp4`
- ❌ 错误：`/video/原创视频/文件名.mp4`（缺少协议和主机）

**解决方法**：
- 检查 `simple_home_page.dart` 中的URL构建逻辑
- 确保URL包含完整的 `http://localhost:8081` 前缀

---

### 原因3：服务器未正确提供视频

**检查服务器日志**：
- 查看 `video_server.py` 的终端输出
- 是否有404错误？
- 是否有其他错误信息？

**解决方法**：
- 检查服务器是否正在运行
- 检查视频文件路径是否正确
- 检查服务器权限

---

### 原因4：视频文件损坏

**检查方法**：
- 在Finder中双击视频文件，看是否能播放
- 如果能播放，说明文件正常
- 如果不能播放，文件可能损坏

**解决方法**：
- 重新上传视频文件
- 或使用其他视频文件测试

---

### 原因5：macOS权限问题

**检查方法**：
- 应用可能需要访问网络或文件的权限

**解决方法**：
- 在"系统设置" → "隐私与安全性"中检查权限
- 允许应用访问网络和文件

---

## 📝 调试信息

### 在终端中查看调试信息

运行应用时，终端会显示：
```
视频播放器初始化，路径: http://localhost:8081/video/原创视频/xxx.mp4
使用网络URL播放: http://localhost:8081/video/原创视频/xxx.mp4
视频初始化成功
开始播放视频
```

如果有错误，会显示：
```
视频初始化失败: [错误信息]
错误类型: [错误类型]
```

---

## 🔧 下一步操作

### 请告诉我：

1. **终端显示了什么调试信息？**
   - 是否有"视频初始化成功"？
   - 是否有错误信息？

2. **播放器显示了什么？**
   - 是黑屏？
   - 还是显示了错误信息？
   - 还是显示了加载提示？

3. **视频文件信息**
   - 视频文件名是什么？
   - 视频格式是什么（.mp4, .mov, .mkv等）？
   - 视频文件大小是多少？

4. **服务器状态**
   - 服务器是否正在运行？
   - 服务器终端显示了什么？

---

## 💡 临时解决方案

如果视频无法播放，可以：

1. **检查视频格式**：确保是MP4格式
2. **测试其他视频**：尝试播放其他视频文件
3. **检查服务器**：确保服务器正在运行
4. **查看错误信息**：应用现在会显示详细的错误信息

---

**请告诉我终端和应用的显示内容，我会帮你进一步排查！** 🚀

