# 服务器编译APK完整指南

## 📊 当前服务器状态

- ✅ **可用空间**: 7.5GB（勉强够用）
- ✅ **视频目录**: 14GB（可以继续清理）
- ✅ **Java**: 已安装（OpenJDK 17）
- ❌ **Flutter**: 未安装
- ❌ **Android SDK**: 未安装

## 🎯 建议

**空间评估**：
- 需要：5-7GB（Flutter + Android SDK + 项目）
- 当前：7.5GB
- **结论**：勉强够用，建议再清理1-2GB视频更安全

---

## 🚀 完整安装流程

### 步骤1：清理空间（可选但推荐）

```bash
# 在服务器上检查视频目录
ssh root@47.243.177.166
du -sh /root/videos/原创视频/*
# 删除一些不常用的视频，释放1-2GB空间
```

### 步骤2：上传项目文件

```bash
# 在本地Mac上执行
cd "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905"
./上传项目到服务器.sh
```

### 步骤3：安装Flutter SDK

```bash
# 在服务器上执行
ssh root@47.243.177.166
cd /root
# 上传安装脚本
# 或者直接执行：
bash <(curl -s https://raw.githubusercontent.com/flutter/flutter/master/bin/internal/update_dart_sdk.sh) || \
wget https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_3.38.2-stable.tar.xz
tar xf flutter_linux_3.38.2-stable.tar.xz
export PATH="$PATH:/root/flutter/bin"
flutter --version
```

### 步骤4：安装Android SDK

```bash
# 在服务器上执行
export ANDROID_HOME=/root/android-sdk
mkdir -p $ANDROID_HOME
cd $ANDROID_HOME
wget https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
unzip commandlinetools-linux-11076708_latest.zip
mkdir -p cmdline-tools
mv cmdline-tools latest
mv latest cmdline-tools/
export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin

# 安装SDK组件
yes | sdkmanager --install "platform-tools" "platforms;android-33" "build-tools;34.0.0"
yes | sdkmanager --licenses
```

### 步骤5：配置Flutter

```bash
# 在服务器上执行
export PATH="$PATH:/root/flutter/bin"
export ANDROID_HOME=/root/android-sdk
export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin

flutter doctor
flutter doctor --android-licenses
```

### 步骤6：编译APK

```bash
# 在服务器上执行
cd /root/app
flutter pub get
flutter build apk --release
```

### 步骤7：下载APK

```bash
# 在本地Mac上执行
scp -i ~/.ssh/id_rsa root@47.243.177.166:/root/app/build/app/outputs/flutter-apk/app-release.apk ~/Desktop/app-release-$(date +%Y%m%d).apk
```

---

## 📝 使用自动化脚本（推荐）

我已经创建了自动化脚本，可以简化流程：

1. **上传项目**：`./上传项目到服务器.sh`
2. **安装Flutter**：在服务器上运行 `服务器安装Flutter.sh`
3. **安装Android SDK**：在服务器上运行 `服务器安装AndroidSDK.sh`
4. **编译APK**：在服务器上运行 `服务器编译APK.sh`

---

## ⚠️ 注意事项

1. **空间管理**：
   - 编译完成后可以删除Flutter和Android SDK（节省空间）
   - 或者保留以便后续编译

2. **网络问题**：
   - 服务器可以访问外网，应该能正常下载
   - 如果下载失败，可以重试

3. **编译时间**：
   - 首次编译：30-60分钟
   - 后续编译：5-10分钟

4. **环境变量**：
   - 每次SSH登录需要重新设置环境变量
   - 或者添加到 `~/.bashrc` 永久生效

---

## 🎯 快速开始

**最简单的方式**：

```bash
# 1. 上传项目
./上传项目到服务器.sh

# 2. 在服务器上安装（一次性）
ssh root@47.243.177.166
# 然后按照上面的步骤3-6执行
```

---

**需要我帮你执行哪个步骤？**










