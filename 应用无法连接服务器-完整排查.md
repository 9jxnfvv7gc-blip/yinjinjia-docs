# 🔍 应用无法连接服务器 - 完整排查

## 📋 当前状态

- ✅ 服务器正常运行（从服务器本地测试正常）
- ✅ URL编码已修复
- ❌ 应用仍无法连接服务器

## 🔍 排查步骤

### 步骤1：确认应用代码已更新

应用需要重新编译才能使用修复后的代码。

在本地 Mac 终端执行：

```bash
cd "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905"
flutter clean
flutter pub get
flutter run -d Dianhua
```

### 步骤2：检查iOS App Transport Security

iOS默认阻止HTTP连接，需要确认 `Info.plist` 已配置允许HTTP。

检查文件：`ios/Runner/Info.plist`

应该包含：
```xml
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSAllowsArbitraryLoads</key>
    <true/>
</dict>
```

### 步骤3：测试从本地Mac访问服务器

在本地 Mac 终端执行：

```bash
# 测试服务器连接
curl http://47.243.177.166:8081/api/list/%E5%8E%9F%E5%88%9B%E8%A7%86%E9%A2%91
```

如果无法访问，可能是网络问题。

### 步骤4：检查应用日志

运行应用时，查看终端输出，应该看到：
- `请求视频列表: http://47.243.177.166:8081/api/list/%E5%8E%9F%E5%88%9B%E8%A7%86%E9%A2%91`
- 如果有错误，会显示错误信息

### 步骤5：检查网络连接

确保：
- iPhone和Mac在同一WiFi网络（如果使用本地服务器）
- iPhone可以访问互联网（访问香港服务器）
- 没有VPN或代理阻止连接

## 🚀 快速修复

### 1. 重新编译应用

```bash
cd "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905"
flutter clean
flutter pub get
flutter run -d Dianhua
```

### 2. 确认Info.plist配置

如果 `Info.plist` 中没有 `NSAppTransportSecurity`，需要添加。

### 3. 查看应用日志

运行应用时，查看终端输出，找到错误信息。

## 📝 常见错误

1. **"No route to host"**：网络连接问题
2. **"Connection refused"**：服务器未运行
3. **"Timeout"**：网络慢或防火墙阻止
4. **"App Transport Security"**：iOS阻止HTTP连接


