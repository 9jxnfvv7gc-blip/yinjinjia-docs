# 服务器连接诊断和修复

## 诊断结果

### ✅ 服务器状态正常
- **服务器进程**：正在运行（PID 6052）
- **端口监听**：8081 端口正常监听（0.0.0.0:8081）
- **防火墙**：8081 端口已开放
- **网络连通性**：从 Mac 可以正常访问
- **API 测试**：成功返回数据（2 个视频）

### ❌ iOS 设备连接失败
- **错误信息**：`No route to host` (errno = 65)
- **可能原因**：
  1. iOS 设备网络路由问题
  2. 运营商网络限制
  3. iOS 设备防火墙/代理设置

## 解决方案

### 方案 1：检查 iOS 设备网络设置

1. **确保设备连接到网络**
   - 检查 WiFi 或移动数据是否开启
   - 尝试访问其他网站确认网络正常

2. **检查代理设置**
   - 设置 → WiFi → 点击当前网络 → 配置代理
   - 如果设置了代理，尝试关闭或配置正确

3. **尝试使用移动数据**
   - 如果 WiFi 无法连接，尝试切换到移动数据

### 方案 2：测试服务器连接

在 iOS 设备上：
1. 打开 Safari 浏览器
2. 访问：`http://47.243.177.166:8081/api/list/原创视频`
3. 如果浏览器可以访问，说明网络正常，问题在应用配置
4. 如果浏览器也无法访问，说明是网络问题

### 方案 3：使用 HTTPS（推荐）

如果可能，配置服务器使用 HTTPS：
- 更安全
- 避免 iOS ATS 限制
- 更好的兼容性

### 方案 4：检查服务器日志

查看服务器是否收到请求：
```bash
ssh root@47.243.177.166
# 查看服务器进程输出
ps aux | grep video_server
# 或者重启服务器并查看输出
```

### 方案 5：临时使用本地服务器测试

如果远程服务器无法访问，可以：
1. 在 Mac 上启动本地服务器
2. 确保 Mac 和 iOS 设备在同一 WiFi
3. 修改 `lib/config.dart` 使用 Mac 的本地 IP

## 已完成的改进

1. ✅ **改进错误处理**
   - 显示更详细的错误信息
   - 提供重试功能
   - 显示连接状态

2. ✅ **增强调试信息**
   - 添加详细的错误日志
   - 显示错误类型和堆栈

## 下一步操作

1. **在 iOS 设备上测试**：
   - 打开 Safari，访问服务器地址
   - 确认网络是否可以访问服务器

2. **检查应用日志**：
   - 重新运行应用
   - 查看终端中的详细错误信息

3. **如果仍然失败**：
   - 考虑使用本地服务器进行开发
   - 或者配置 HTTPS 服务器

## 服务器信息

- **IP 地址**：47.243.177.166
- **端口**：8081
- **协议**：HTTP
- **状态**：运行中
- **防火墙**：已开放

## 测试命令

在 Mac 上测试服务器：
```bash
# 测试连接
curl http://47.243.177.166:8081/api/list/原创视频

# 测试视频列表
curl http://47.243.177.166:8081/api/list/原创歌曲
```


