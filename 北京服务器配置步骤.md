# 北京服务器配置步骤

## 1. 创建目录（在服务器终端执行）

```bash
sudo mkdir -p /root/video_server
sudo mkdir -p /root/videos
```

## 2. 上传 video_server.py 文件

### 方法A：使用 Workbench 文件管理器（推荐）

1. 在 Workbench 中打开**文件管理器**
2. 导航到 `/root/video_server/` 目录
3. 点击**上传文件**按钮
4. 选择本地的 `video_server.py` 文件
5. 等待上传完成

### 方法B：如果 Workbench 文件管理器不可用

可以使用以下方法之一：

#### 方法B1：使用 `cat` 和 heredoc（适合小文件，不推荐用于大文件）

由于文件较大，此方法不推荐。

#### 方法B2：配置 SSH 密钥（推荐用于长期使用）

1. 在本地 Mac 上生成 SSH 密钥（如果还没有）：
```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

2. 复制公钥到服务器：
```bash
cat ~/.ssh/id_rsa.pub
```

3. 在服务器上添加公钥：
```bash
mkdir -p ~/.ssh
echo "你的公钥内容" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

4. 然后就可以使用 `scp` 上传：
```bash
scp "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905/video_server.py" admin@39.107.137.136:/tmp/
```

## 3. 修改 VIDEO_ROOT 配置

上传完成后，在服务器上执行：

```bash
sudo sed -i '20s|VIDEO_ROOT = "/Volumes/Expansion"|VIDEO_ROOT = "/root/videos"|g' /root/video_server/video_server.py
```

## 4. 修改服务器IP（如果需要）

如果服务器IP不是 47.243.177.166，需要修改代码中的IP地址：

```bash
sudo sed -i 's/47.243.177.166:8081/39.107.137.136:8081/g' /root/video_server/video_server.py
```

## 5. 设置执行权限

```bash
sudo chmod +x /root/video_server/video_server.py
```

## 6. 测试运行

```bash
cd /root/video_server
sudo python3 video_server.py
```

## 7. 配置自动启动（systemd 服务）

创建服务文件：

```bash
sudo tee /etc/systemd/system/video-server-beijing.service > /dev/null << 'EOF'
[Unit]
Description=Video Server (Beijing)
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/video_server
ExecStart=/usr/bin/python3 /root/video_server/video_server.py
Restart=always
RestartSec=10
StandardOutput=append:/var/log/video-server-beijing.log
StandardError=append:/var/log/video-server-beijing-error.log

[Install]
WantedBy=multi-user.target
EOF
```

启用并启动服务：

```bash
sudo systemctl daemon-reload
sudo systemctl enable video-server-beijing
sudo systemctl start video-server-beijing
```

检查状态：

```bash
sudo systemctl status video-server-beijing
```

## 8. 配置防火墙

```bash
sudo ufw allow 8081/tcp
sudo ufw reload
```

## 9. 配置阿里云安全组

在阿里云控制台：
1. 进入 ECS 实例管理
2. 点击安全组
3. 添加入站规则：端口 8081，协议 TCP，源 0.0.0.0/0
