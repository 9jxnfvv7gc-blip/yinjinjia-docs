# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œè‡ªåŠ¨æ·»åŠ è„šæœ¬

## ðŸš€ æ–¹æ³•1ï¼šç›´æŽ¥å¤åˆ¶è„šæœ¬åˆ°æœåŠ¡å™¨ï¼ˆæŽ¨èï¼‰

### æ­¥éª¤1ï¼šé€€å‡ºnanoç¼–è¾‘å™¨

å¦‚æžœè¿˜åœ¨nanoä¸­ï¼š
- æŒ‰ `Ctrl+X`
- æŒ‰ `N`ï¼ˆä¸ä¿å­˜ï¼‰

---

### æ­¥éª¤2ï¼šåœ¨Workbenchç»ˆç«¯æ‰§è¡Œ

```bash
# åœæ­¢æœåŠ¡å™¨
systemctl stop video-server

# å¤‡ä»½åŽŸæ–‡ä»¶
cp /root/video_server/video_server.py /root/video_server/video_server.py.bak4

# åˆ›å»ºPythonè„šæœ¬
cat > /tmp/add_debug.py << 'EOF'
#!/usr/bin/env python3
import sys
import os

file_path = '/root/video_server/video_server.py'
backup_path = '/root/video_server/video_server.py.bak4'

print(f"è¯»å–æ–‡ä»¶: {file_path}")
with open(file_path, 'r', encoding='utf-8') as f:
    lines = f.readlines()

print(f"å¤‡ä»½æ–‡ä»¶åˆ°: {backup_path}")
with open(backup_path, 'w', encoding='utf-8') as f:
    f.writelines(lines)

new_lines = []
i = 0
found_643 = False
found_650 = False
found_677 = False

while i < len(lines):
    line = lines[i]
    new_lines.append(line)
    
    if 'if os.path.exists(category_path):' in line and not found_643:
        if i + 1 < len(lines) and 'ç›®å½•å­˜åœ¨ï¼Œå¼€å§‹æ‰«ææ–‡ä»¶' in lines[i + 1]:
            print("ç¬¬643è¡Œï¼šè°ƒè¯•ä¿¡æ¯å·²å­˜åœ¨ï¼Œè·³è¿‡")
        else:
            new_lines.append('                print(f"ç›®å½•å­˜åœ¨ï¼Œå¼€å§‹æ‰«ææ–‡ä»¶...")\n')
            print("ç¬¬643è¡Œï¼šå·²æ·»åŠ è°ƒè¯•ä¿¡æ¯")
        found_643 = True
    
    if 'if ext in all_media_extensions:' in line and not found_650:
        if i > 0 and 'æ–‡ä»¶: {f}, æ‰©å±•å:' in lines[i - 1]:
            print("ç¬¬650è¡Œï¼šè°ƒè¯•ä¿¡æ¯å·²å­˜åœ¨ï¼Œè·³è¿‡")
        else:
            new_lines.insert(-1, '                        print(f"æ–‡ä»¶: {f}, æ‰©å±•å: {ext}, åœ¨åˆ—è¡¨ä¸­: {ext in all_media_extensions}")\n')
            print("ç¬¬650è¡Œï¼šå·²æ·»åŠ è°ƒè¯•ä¿¡æ¯")
            i += 1
            continue
        found_650 = True
    
    if '})' in line and i > 0 and 'file_list.append' in ''.join(lines[max(0, i-10):i]):
        if i + 1 < len(lines) and 'æ‰¾åˆ° {len(file_list)}' in lines[i + 1]:
            print("ç¬¬677è¡Œï¼šè°ƒè¯•ä¿¡æ¯å·²å­˜åœ¨ï¼Œè·³è¿‡")
        elif not found_677:
            for j in range(i, max(0, i-20), -1):
                if 'file_list.append' in lines[j]:
                    new_lines.append('                print(f"æ‰¾åˆ° {len(file_list)} ä¸ªæ–‡ä»¶")\n')
                    print("ç¬¬677è¡Œï¼šå·²æ·»åŠ è°ƒè¯•ä¿¡æ¯")
                    found_677 = True
                    break
    
    i += 1

print(f"å†™å…¥æ–‡ä»¶: {file_path}")
with open(file_path, 'w', encoding='utf-8') as f:
    f.writelines(new_lines)

print("å®Œæˆï¼è°ƒè¯•ä¿¡æ¯å·²æ·»åŠ ã€‚")
EOF

# è¿è¡Œè„šæœ¬
python3 /tmp/add_debug.py

# æ£€æŸ¥è¯­æ³•
python3 -m py_compile /root/video_server/video_server.py

# å¦‚æžœè¯­æ³•æ­£ç¡®ï¼Œå¯åŠ¨æœåŠ¡å™¨
systemctl start video-server
systemctl status video-server
```

---

## ðŸŽ¯ çŽ°åœ¨å¯ä»¥æ‰§è¡Œ

1. **é€€å‡ºnano**ï¼ˆå¦‚æžœè¿˜åœ¨nanoä¸­ï¼š`Ctrl+X`, `N`ï¼‰
2. **å¤åˆ¶ä¸Šé¢çš„å‘½ä»¤åˆ°Workbenchç»ˆç«¯æ‰§è¡Œ**
3. **è„šæœ¬ä¼šè‡ªåŠ¨æ·»åŠ è°ƒè¯•ä¿¡æ¯**
4. **æ£€æŸ¥è¯­æ³•å¹¶å¯åŠ¨æœåŠ¡å™¨**

---

## ðŸ’¡ æç¤º

- **è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½åŽŸæ–‡ä»¶**ï¼ˆ`video_server.py.bak4`ï¼‰
- **å¦‚æžœè°ƒè¯•ä¿¡æ¯å·²å­˜åœ¨ï¼Œä¼šè·³è¿‡**
- **è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥è¯­æ³•**

---

**å¤åˆ¶ä¸Šé¢çš„å‘½ä»¤åˆ°Workbenchç»ˆç«¯æ‰§è¡Œå³å¯ï¼** ðŸš€

