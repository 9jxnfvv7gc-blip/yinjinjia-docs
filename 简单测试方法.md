# ç®€å•æµ‹è¯•æ–¹æ³•

## ğŸ” ç›´æ¥æµ‹è¯•ä»£ç é€»è¾‘

### åœ¨Workbenchç»ˆç«¯æ‰§è¡Œï¼š

```bash
# åœæ­¢åå°æœåŠ¡å™¨
pkill -f video_server.py

# åœæ­¢systemdæœåŠ¡
systemctl stop video-server

# ç›´æ¥æµ‹è¯•Pythonä»£ç é€»è¾‘
cd /root/video_server
python3 << 'EOF'
import os
import json
import urllib.parse

VIDEO_ROOT = '/root/videos'
category = 'åŸåˆ›è§†é¢‘'
category_path = os.path.join(VIDEO_ROOT, category)

print(f"category_path: {category_path}")
print(f"è·¯å¾„å­˜åœ¨: {os.path.exists(category_path)}")

videos = []
file_list = []

if os.path.exists(category_path):
    print("ç›®å½•å­˜åœ¨ï¼Œå¼€å§‹æ‰«ææ–‡ä»¶...")
    
    # è§†é¢‘æ‰©å±•å
    video_extensions = ['.mp4', '.mov', '.mkv', '.avi', '.flv', '.wmv', '.webm']
    # éŸ³é¢‘æ‰©å±•å
    audio_extensions = ['.mp3', '.wav', '.flac', '.aac', '.m4a', '.ogg', '.wma']
    # æ‰€æœ‰åª’ä½“æ‰©å±•å
    all_media_extensions = video_extensions + audio_extensions
    
    files = os.listdir(category_path)
    print(f"æ–‡ä»¶æ•°é‡: {len(files)}")
    
    for f in files:
        file_path = os.path.join(category_path, f)
        if os.path.isfile(file_path):
            ext = os.path.splitext(f)[1].lower()
            print(f"æ–‡ä»¶: {f}, æ‰©å±•å: {ext}, åœ¨åˆ—è¡¨ä¸­: {ext in all_media_extensions}")
            
            if ext in all_media_extensions:
                # æ„å»ºURL
                relative_path = os.path.relpath(file_path, VIDEO_ROOT)
                url = f"http://47.243.177.166:8081/{relative_path.replace(os.sep, '/')}"
                
                file_list.append({
                    'title': f,
                    'url': url,
                    'id': f
                })
                print(f"  æ·»åŠ åˆ°file_list: {f}")
    
    print(f"file_listé•¿åº¦: {len(file_list)}")
    print(f"file_listå†…å®¹: {file_list}")
    
    # æ„å»ºè¿”å›ç»“æœ
    for item in file_list:
        videos.append({
            'title': item['title'],
            'url': item['url'],
            'id': item['id']
        })
    
    print(f"videosé•¿åº¦: {len(videos)}")
    print(f"videoså†…å®¹: {videos}")
    
    # è¿”å›JSON
    result = json.dumps(videos, ensure_ascii=False)
    print(f"JSONç»“æœ: {result}")
else:
    print(f"ç›®å½•ä¸å­˜åœ¨: {category_path}")
EOF
```

---

## ğŸ¯ è¿™ä¸ªæµ‹è¯•ä¼šå‘Šè¯‰æˆ‘ä»¬

1. **æ–‡ä»¶æ˜¯å¦èƒ½è¢«æ­£ç¡®æ‰«æ**
2. **file_listæ˜¯å¦è¢«æ­£ç¡®æ„å»º**
3. **videosæ˜¯å¦è¢«æ­£ç¡®å¡«å……**
4. **JSONæ˜¯å¦æ­£ç¡®ç”Ÿæˆ**

---

## ğŸ“‹ æ‰§è¡Œå

æŠŠè¾“å‡ºç»“æœå‘ç»™æˆ‘ï¼Œæˆ‘ä¼šæ ¹æ®ç»“æœåˆ¤æ–­é—®é¢˜åœ¨å“ªé‡Œã€‚

---

**å…ˆæ‰§è¡Œè¿™ä¸ªæµ‹è¯•ï¼ŒæŠŠç»“æœå‘ç»™æˆ‘ï¼** ğŸ”

