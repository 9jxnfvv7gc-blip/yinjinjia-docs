# 解决端口被占用问题

## ❌ 错误信息

```
OSError: [Errno 48] Address already in use
```

**原因**：端口8081已经被其他进程占用，很可能是之前后台运行的服务器进程。

---

## ✅ 解决方案

### 步骤1：找到占用端口的进程

在终端执行：

```bash
# 查找占用8081端口的进程
lsof -i :8081
```

**或者**：

```bash
# 查找video_server.py进程
ps aux | grep video_server.py | grep -v grep
```

---

### 步骤2：停止占用端口的进程

#### 方法A：使用进程ID（PID）

如果 `lsof` 或 `ps` 显示了进程ID（PID），使用：

```bash
# 停止进程（替换PID为实际进程ID）
kill PID
```

**或者强制停止**：

```bash
kill -9 PID
```

#### 方法B：直接停止所有video_server.py进程

```bash
# 停止所有video_server.py进程
pkill -f video_server.py
```

**或者强制停止**：

```bash
pkill -9 -f video_server.py
```

---

### 步骤3：验证端口已释放

```bash
# 再次检查端口
lsof -i :8081
```

**如果没有输出**：✅ 端口已释放

**如果还有输出**：继续停止进程

---

### 步骤4：重新启动服务器

```bash
cd "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905"
python3 video_server.py
```

**应该看到**：
```
启动视频服务器...
端口: 8081
视频根目录: /Volumes/Expansion
Serving at port 8081
```

---

## 📋 完整操作流程

### 1. 查找占用端口的进程

```bash
lsof -i :8081
```

**输出示例**：
```
COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
Python  12345 user    3u  IPv4  ...      0t0  TCP *:8081 (LISTEN)
```

**记录PID**（这里是12345）

---

### 2. 停止进程

```bash
# 使用PID停止（替换为实际PID）
kill 12345

# 或者直接停止所有video_server.py进程
pkill -f video_server.py
```

---

### 3. 验证端口已释放

```bash
lsof -i :8081
```

**如果没有输出**：✅ 可以继续

---

### 4. 重新启动服务器

```bash
cd "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905"
python3 video_server.py
```

---

## 🔍 详细说明

### 为什么会出现这个问题？

1. **之前用 `&` 后台运行了服务器**
   - 进程在后台继续运行
   - 占用了端口8081

2. **没有正确停止服务器**
   - 直接关闭终端窗口
   - 进程还在运行

3. **多个服务器实例**
   - 启动了多个服务器
   - 都尝试使用同一个端口

---

## 💡 预防措施

### 正确停止服务器：

1. **如果服务器在前台运行**：
   - 按 `Ctrl+C` 停止

2. **如果服务器在后台运行**：
   - 使用 `pkill -f video_server.py` 停止
   - 或使用 `kill PID` 停止

3. **启动前检查**：
   - 先检查端口是否被占用
   - 如果被占用，先停止旧进程

---

## 📝 快速命令

### 查找占用端口的进程：
```bash
lsof -i :8081
```

### 停止所有video_server.py进程：
```bash
pkill -f video_server.py
```

### 验证端口已释放：
```bash
lsof -i :8081
```

### 重新启动服务器：
```bash
cd "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905"
python3 video_server.py
```

---

## ✅ 总结

1. **找到占用端口的进程**：`lsof -i :8081`
2. **停止进程**：`pkill -f video_server.py`
3. **验证端口已释放**：`lsof -i :8081`
4. **重新启动服务器**：`python3 video_server.py`

---

**现在执行这些命令，停止旧进程并重新启动服务器！** 🚀

