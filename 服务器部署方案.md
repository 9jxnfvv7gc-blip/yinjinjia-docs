# æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ - è®©è§†é¢‘å’Œæ­Œæ›²å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Š

## ðŸŽ¯ ç›®æ ‡

1. âœ… è§†é¢‘å’Œæ­Œæ›²å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼ˆä¸æ˜¯æœ¬åœ°ï¼‰
2. âœ… ç”¨æˆ·æ‰“å¼€åº”ç”¨å°±èƒ½çœ‹åˆ°å†…å®¹ï¼ˆåƒæŠ–éŸ³é‚£æ ·ï¼‰
3. âœ… æ”¯æŒè¿œç¨‹è®¿é—®
4. âœ… å¯ä»¥ä¸Šæž¶åˆ°App Store

---

## ðŸ“‹ å½“å‰æž¶æž„ vs ç›®æ ‡æž¶æž„

### å½“å‰æž¶æž„ï¼ˆæœ¬åœ°ï¼‰

```
ç”¨æˆ·è®¾å¤‡ â†’ localhost:8081 â†’ æœ¬åœ°Mac â†’ /Volumes/Expansion/åŽŸåˆ›è§†é¢‘
```

**é—®é¢˜**ï¼š
- âŒ åªèƒ½æœ¬åœ°è®¿é—®
- âŒ ç”¨æˆ·æ— æ³•çœ‹åˆ°å†…å®¹
- âŒ ä¸é€‚åˆä¸Šæž¶

---

### ç›®æ ‡æž¶æž„ï¼ˆæœåŠ¡å™¨ï¼‰

```
ç”¨æˆ·è®¾å¤‡ â†’ æœåŠ¡å™¨IP:8081 â†’ æœåŠ¡å™¨ â†’ /root/videos/åŽŸåˆ›è§†é¢‘
```

**ä¼˜ç‚¹**ï¼š
- âœ… è¿œç¨‹è®¿é—®
- âœ… æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°ç›¸åŒå†…å®¹
- âœ… å¯ä»¥ä¸Šæž¶
- âœ… åƒæŠ–éŸ³é‚£æ ·ï¼Œæ‰“å¼€å°±èƒ½çœ‹åˆ°å†…å®¹

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨çŽ°æœ‰æœåŠ¡å™¨éƒ¨ç½²ï¼ˆæŽ¨èï¼‰

**ä½ å·²ç»æœ‰äº†é¦™æ¸¯æœåŠ¡å™¨**ï¼ˆ47.243.177.166ï¼‰ï¼Œå¯ä»¥ï¼š

1. **åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²video_server.py**
2. **åœ¨æœåŠ¡å™¨ä¸Šå­˜å‚¨è§†é¢‘å’Œæ­Œæ›²**
3. **ä¿®æ”¹åº”ç”¨é…ç½®ï¼Œè¿žæŽ¥åˆ°æœåŠ¡å™¨**

---

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨äº‘å­˜å‚¨ï¼ˆé˜¿é‡Œäº‘OSSï¼‰

**æ›´ä¸“ä¸šçš„æ–¹æ¡ˆ**ï¼š

1. **ä½¿ç”¨é˜¿é‡Œäº‘OSSå­˜å‚¨è§†é¢‘å’Œæ­Œæ›²**
2. **ä½¿ç”¨æœåŠ¡å™¨APIç®¡ç†å†…å®¹**
3. **åº”ç”¨ç›´æŽ¥è¿žæŽ¥OSSæˆ–é€šè¿‡APIè®¿é—®**

---

## ðŸš€ æŽ¨èæ–¹æ¡ˆï¼šåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²

### æ­¥éª¤1ï¼šåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²video_server.py

#### 1.1 ä¸Šä¼ video_server.pyåˆ°æœåŠ¡å™¨

åœ¨æœ¬åœ°Macç»ˆç«¯æ‰§è¡Œï¼š

```bash
# ä¸Šä¼ video_server.pyåˆ°æœåŠ¡å™¨
scp /Volumes/Expansion/FlutterProjects/æ¡Œé¢å½±éŸ³æ’­æ”¾å™¨_å®‰è£…åŒ…_20251121_165905/video_server.py root@47.243.177.166:/root/video_server/
```

**æˆ–è€…ä½¿ç”¨Workbenchæ–‡ä»¶ä¸Šä¼ **

---

#### 1.2 åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•

åœ¨æœåŠ¡å™¨Workbenchç»ˆç«¯æ‰§è¡Œï¼š

```bash
# åˆ›å»ºè§†é¢‘å’Œæ­Œæ›²ç›®å½•
mkdir -p /root/videos/åŽŸåˆ›è§†é¢‘
mkdir -p /root/videos/åŽŸåˆ›æ­Œæ›²

# åˆ›å»ºæœåŠ¡å™¨ç›®å½•
mkdir -p /root/video_server
```

---

#### 1.3 ä¿®æ”¹æœåŠ¡å™¨é…ç½®

åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹ `video_server.py`ï¼š

```python
PORT = 8081
VIDEO_ROOT = "/root/videos"  # æ”¹æˆæœåŠ¡å™¨è·¯å¾„
```

---

#### 1.4 å¯åŠ¨æœåŠ¡å™¨

åœ¨æœåŠ¡å™¨Workbenchç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /root/video_server
python3 video_server.py
```

**æˆ–è€…ä½¿ç”¨systemdæœåŠ¡**ï¼ˆæŽ¨èï¼Œè‡ªåŠ¨å¯åŠ¨ï¼‰ï¼š

```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
cat > /etc/systemd/system/video-server.service << 'EOF'
[Unit]
Description=Video Server
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/video_server
ExecStart=/usr/bin/python3 /root/video_server/video_server.py
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
systemctl daemon-reload
systemctl enable video-server
systemctl start video-server

# æŸ¥çœ‹çŠ¶æ€
systemctl status video-server
```

---

### æ­¥éª¤2ï¼šä¿®æ”¹åº”ç”¨é…ç½®

#### 2.1 ä¿®æ”¹config.dart

å°† `developmentApiUrl` æ”¹ä¸ºæœåŠ¡å™¨åœ°å€ï¼š

```dart
/// å¼€å‘çŽ¯å¢ƒAPIæœåŠ¡å™¨åœ°å€
static const String developmentApiUrl = 'http://47.243.177.166:8081';
```

**æˆ–è€…æ ¹æ®çŽ¯å¢ƒè‡ªåŠ¨åˆ‡æ¢**ï¼š

```dart
static String get apiBaseUrl {
  // ç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨æœåŠ¡å™¨åœ°å€
  const bool isProduction = bool.fromEnvironment('PRODUCTION', defaultValue: false);
  if (isProduction) {
    return 'http://47.243.177.166:8081';  // æœåŠ¡å™¨åœ°å€
  }
  return 'http://localhost:8081';  // æœ¬åœ°å¼€å‘
}
```

---

#### 2.2 é‡æ–°æž„å»ºåº”ç”¨

```bash
# iOS
flutter build ios --release

# Android
flutter build apk --release
```

---

### æ­¥éª¤3ï¼šä¸Šä¼ å†…å®¹åˆ°æœåŠ¡å™¨

#### æ–¹æ³•1ï¼šä½¿ç”¨rsyncä¸Šä¼ 

```bash
# ä¸Šä¼ è§†é¢‘
rsync -avz --progress /Volumes/Expansion/åŽŸåˆ›è§†é¢‘/ root@47.243.177.166:/root/videos/åŽŸåˆ›è§†é¢‘/

# ä¸Šä¼ æ­Œæ›²
rsync -avz --progress /Volumes/Expansion/åŽŸåˆ›æ­Œæ›²/ root@47.243.177.166:/root/videos/åŽŸåˆ›æ­Œæ›²/
```

#### æ–¹æ³•2ï¼šä½¿ç”¨Workbenchæ–‡ä»¶ä¸Šä¼ 

1. åœ¨Workbenchä¸­ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
2. ä¸Šä¼ è§†é¢‘å’Œæ­Œæ›²åˆ°æœåŠ¡å™¨

---

## ðŸ”§ è¯¦ç»†é…ç½®æ­¥éª¤

### æ­¥éª¤1ï¼šåœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®

#### 1.1 åˆ›å»ºç›®å½•ç»“æž„

```bash
mkdir -p /root/videos/åŽŸåˆ›è§†é¢‘
mkdir -p /root/videos/åŽŸåˆ›æ­Œæ›²
mkdir -p /root/video_server
```

#### 1.2 ä¸Šä¼ å¹¶é…ç½®video_server.py

```bash
# ä¸Šä¼ æ–‡ä»¶ï¼ˆä½¿ç”¨Workbenchæˆ–scpï¼‰
# ç„¶åŽä¿®æ”¹VIDEO_ROOT
sed -i 's|VIDEO_ROOT = "/Volumes/Expansion"|VIDEO_ROOT = "/root/videos"|g' /root/video_server/video_server.py
```

#### 1.3 å¯åŠ¨æœåŠ¡å™¨

```bash
cd /root/video_server
python3 video_server.py
```

---

### æ­¥éª¤2ï¼šä¿®æ”¹åº”ç”¨ä»£ç 

#### 2.1 ä¿®æ”¹config.dart

```dart
class AppConfig {
  /// ç”Ÿäº§çŽ¯å¢ƒAPIæœåŠ¡å™¨åœ°å€
  static const String productionApiUrl = 'http://47.243.177.166:8081';
  
  /// å¼€å‘çŽ¯å¢ƒAPIæœåŠ¡å™¨åœ°å€
  static const String developmentApiUrl = 'http://localhost:8081';
  
  /// å½“å‰ä½¿ç”¨çš„APIæœåŠ¡å™¨åœ°å€
  static String get apiBaseUrl {
    // æ ¹æ®æž„å»ºç±»åž‹é€‰æ‹©
    const bool isProduction = bool.fromEnvironment('PRODUCTION', defaultValue: false);
    return isProduction ? productionApiUrl : developmentApiUrl;
  }
}
```

#### 2.2 æˆ–è€…ç›´æŽ¥ä¿®æ”¹ä¸ºæœåŠ¡å™¨åœ°å€

```dart
/// å¼€å‘çŽ¯å¢ƒAPIæœåŠ¡å™¨åœ°å€
static const String developmentApiUrl = 'http://47.243.177.166:8081';
```

---

### æ­¥éª¤3ï¼šæµ‹è¯•æœåŠ¡å™¨

#### 3.1 åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•

è®¿é—®ï¼š`http://47.243.177.166:8081`

åº”è¯¥çœ‹åˆ°æœåŠ¡å™¨çŠ¶æ€é¡µé¢ã€‚

#### 3.2 æµ‹è¯•API

```bash
# æµ‹è¯•åˆ—è¡¨API
curl http://47.243.177.166:8081/api/list/åŽŸåˆ›è§†é¢‘
```

---

## ðŸ“‹ å®Œæ•´æ“ä½œæµç¨‹

### 1. æœåŠ¡å™¨ç«¯è®¾ç½®

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
mkdir -p /root/videos/åŽŸåˆ›è§†é¢‘
mkdir -p /root/videos/åŽŸåˆ›æ­Œæ›²
mkdir -p /root/video_server

# ä¸Šä¼ video_server.pyï¼ˆä½¿ç”¨Workbenchæˆ–scpï¼‰
# ä¿®æ”¹VIDEO_ROOTä¸º/root/videos
# å¯åŠ¨æœåŠ¡å™¨
cd /root/video_server
python3 video_server.py
```

---

### 2. åº”ç”¨ç«¯ä¿®æ”¹

```dart
// ä¿®æ”¹lib/config.dart
static const String developmentApiUrl = 'http://47.243.177.166:8081';
```

---

### 3. ä¸Šä¼ å†…å®¹

```bash
# ä¸Šä¼ è§†é¢‘å’Œæ­Œæ›²åˆ°æœåŠ¡å™¨
rsync -avz --progress /Volumes/Expansion/åŽŸåˆ›è§†é¢‘/ root@47.243.177.166:/root/videos/åŽŸåˆ›è§†é¢‘/
rsync -avz --progress /Volumes/Expansion/åŽŸåˆ›æ­Œæ›²/ root@47.243.177.166:/root/videos/åŽŸåˆ›æ­Œæ›²/
```

---

### 4. é‡æ–°æž„å»ºåº”ç”¨

```bash
# iOS
flutter build ios --release

# Android
flutter build apk --release
```

---

## ðŸ’¡ é‡è¦æç¤º

### å…³äºŽæœåŠ¡å™¨ï¼š

1. **æœåŠ¡å™¨éœ€è¦ä¸€ç›´è¿è¡Œ**ï¼šä½¿ç”¨systemdæœåŠ¡è‡ªåŠ¨å¯åŠ¨
2. **å¼€æ”¾ç«¯å£8081**ï¼šç¡®ä¿é˜²ç«å¢™å…è®¸
3. **å­˜å‚¨ç©ºé—´**ï¼šç¡®ä¿æœåŠ¡å™¨æœ‰è¶³å¤Ÿç©ºé—´å­˜å‚¨è§†é¢‘å’Œæ­Œæ›²

### å…³äºŽåº”ç”¨ï¼š

1. **ä¿®æ”¹é…ç½®**ï¼šå°†localhostæ”¹ä¸ºæœåŠ¡å™¨IP
2. **é‡æ–°æž„å»º**ï¼šä¿®æ”¹é…ç½®åŽéœ€è¦é‡æ–°æž„å»º
3. **æµ‹è¯•è¿žæŽ¥**ï¼šç¡®ä¿åº”ç”¨å¯ä»¥è¿žæŽ¥åˆ°æœåŠ¡å™¨

### å…³äºŽå†…å®¹ï¼š

1. **ä¸Šä¼ å†…å®¹**ï¼šå°†è§†é¢‘å’Œæ­Œæ›²ä¸Šä¼ åˆ°æœåŠ¡å™¨
2. **æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°ç›¸åŒå†…å®¹**ï¼šåƒæŠ–éŸ³é‚£æ ·
3. **å¯ä»¥éšæ—¶æ›´æ–°**ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ·»åŠ /åˆ é™¤å†…å®¹

---

## ðŸŽ¯ æŽ¨èæ“ä½œ

### çŽ°åœ¨å¯ä»¥ï¼š

1. **åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²video_server.py**
2. **ä¿®æ”¹åº”ç”¨é…ç½®è¿žæŽ¥åˆ°æœåŠ¡å™¨**
3. **ä¸Šä¼ å†…å®¹åˆ°æœåŠ¡å™¨**
4. **é‡æ–°æž„å»ºåº”ç”¨**

---

**è¿™æ ·ç”¨æˆ·æ‰“å¼€åº”ç”¨å°±èƒ½çœ‹åˆ°å†…å®¹ï¼Œå°±åƒæŠ–éŸ³é‚£æ ·ï¼** ðŸš€

