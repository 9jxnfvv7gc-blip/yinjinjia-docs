# åœ¨åŒä¸€ç»ˆç«¯æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯

## ğŸš€ æ–¹æ³•1ï¼šåå°è¿è¡ŒæœåŠ¡å™¨ï¼ˆæ¨èï¼‰

### åœ¨Workbenchç»ˆç«¯æ‰§è¡Œï¼š

```bash
# åœæ­¢systemdæœåŠ¡
systemctl stop video-server

# åå°è¿è¡ŒæœåŠ¡å™¨
cd /root/video_server
python3 video_server.py > /tmp/video_server.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep video_server.py

# ç­‰å¾…å‡ ç§’è®©æœåŠ¡å™¨å¯åŠ¨
sleep 2

# è®¿é—®API
curl http://localhost:8081/api/list/åŸåˆ›è§†é¢‘

# æŸ¥çœ‹æœåŠ¡å™¨è¾“å‡ºï¼ˆè°ƒè¯•ä¿¡æ¯ï¼‰
cat /tmp/video_server.log

# åœæ­¢åå°æœåŠ¡å™¨
pkill -f video_server.py
```

---

## ğŸš€ æ–¹æ³•2ï¼šä¿®æ”¹ä»£ç ä½¿ç”¨sys.stderrï¼ˆsystemdå¯ä»¥æ•è·ï¼‰

### åœ¨Workbenchç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /root/video_server

# å¤‡ä»½æ–‡ä»¶
cp video_server.py video_server.py.bak8

# ä¿®æ”¹printä¸ºsys.stderr.writeï¼ˆè¿™æ ·systemdå¯ä»¥æ•è·ï¼‰
sed -i 's/print(f"APIåˆ—è¡¨è¯·æ±‚:/import sys\n            sys.stderr.write(f"APIåˆ—è¡¨è¯·æ±‚:/g' video_server.py
sed -i 's/print(f"VIDEO_ROOT:/sys.stderr.write(f"VIDEO_ROOT:/g' video_server.py
sed -i 's/print(f"è·¯å¾„å­˜åœ¨:/sys.stderr.write(f"è·¯å¾„å­˜åœ¨:/g' video_server.py
sed -i 's/print(f"ç›®å½•å­˜åœ¨ï¼Œå¼€å§‹æ‰«ææ–‡ä»¶...")/sys.stderr.write(f"ç›®å½•å­˜åœ¨ï¼Œå¼€å§‹æ‰«ææ–‡ä»¶...\\n")/g' video_server.py
sed -i 's/print(f"æ–‡ä»¶: {f}, æ‰©å±•å:/sys.stderr.write(f"æ–‡ä»¶: {f}, æ‰©å±•å:/g' video_server.py
sed -i 's/print(f"æ‰¾åˆ° {len(file_list)} ä¸ªæ–‡ä»¶")/sys.stderr.write(f"æ‰¾åˆ° {len(file_list)} ä¸ªæ–‡ä»¶\\n")/g' video_server.py

# æ£€æŸ¥è¯­æ³•
python3 -m py_compile /root/video_server/video_server.py

# å¯åŠ¨æœåŠ¡å™¨
systemctl start video-server

# æŸ¥çœ‹æ—¥å¿—ï¼ˆç°åœ¨åº”è¯¥èƒ½çœ‹åˆ°è°ƒè¯•ä¿¡æ¯ï¼‰
journalctl -u video-server -f
```

ç„¶åè®¿é—®APIï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯æˆ–æŒ‰Ctrl+Cé€€å‡ºæ—¥å¿—æŸ¥çœ‹ï¼‰ï¼š
```bash
curl http://localhost:8081/api/list/åŸåˆ›è§†é¢‘
```

---

## ğŸš€ æ–¹æ³•3ï¼šç›´æ¥æ£€æŸ¥APIè¿”å›ï¼ˆæœ€ç®€å•ï¼‰

### åœ¨Workbenchç»ˆç«¯æ‰§è¡Œï¼š

```bash
# è®¿é—®APIå¹¶æŸ¥çœ‹è¿”å›
curl http://localhost:8081/api/list/åŸåˆ›è§†é¢‘ | python3 -m json.tool
```

**å¦‚æœè¿”å›ç©ºæ•°ç»„ `[]`**ï¼Œè¯´æ˜æœåŠ¡å™¨æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶ã€‚

**å¦‚æœè¿”å›æ–‡ä»¶åˆ—è¡¨**ï¼Œè¯´æ˜é—®é¢˜å·²è§£å†³ã€‚

---

## ğŸ¯ æ¨èæ“ä½œ

**ä½¿ç”¨æ–¹æ³•1ï¼ˆåå°è¿è¡Œï¼‰**ï¼š
1. åå°è¿è¡ŒæœåŠ¡å™¨
2. è®¿é—®API
3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„è°ƒè¯•ä¿¡æ¯

---

**å…ˆä½¿ç”¨æ–¹æ³•1ï¼Œå‘Šè¯‰æˆ‘ç»“æœï¼** ğŸš€

