# 📱 手机代理配置完整步骤（2025-11-26）

## ✅ 服务器端状态

- ✅ Squid 代理服务已优化并运行
- ✅ 可以访问百度（HTTP 200）
- ✅ 可以访问 Google（HTTP 200）
- ✅ 端口 3128 已开放

---

## 🚨 最重要：配置阿里云安全组

**这是最关键的一步！如果没有配置，手机无法连接代理！**

### 详细步骤

1. **登录阿里云控制台**：https://ecs.console.aliyun.com

2. **进入实例管理**：
   - 左侧菜单 → 实例与镜像 → 实例
   - 找到你的香港服务器（IP: 47.243.177.166）

3. **进入安全组**：
   - 点击实例名称
   - 点击"安全组"标签
   - 点击安全组 ID（进入安全组规则页面）

4. **添加入站规则**：
   - 点击"添加安全组规则"
   - **规则方向**：入方向
   - **授权策略**：允许
   - **优先级**：1（默认）
   - **协议类型**：自定义 TCP
   - **端口范围**：`3128/3128`
   - **授权对象**：`0.0.0.0/0`
   - **描述**：Squid 代理服务
   - 点击"保存"

5. **确认规则已添加**：
   - 在入站规则列表中，应该能看到 3128 端口的规则

---

## 📱 iPhone 配置步骤（按顺序操作）

### 步骤1：确保使用 Wi-Fi

1. **设置 → Wi-Fi**
2. **确保已连接到 Wi-Fi**（不是数据流量）
3. **如果使用数据流量，请切换到 Wi-Fi**

### 步骤2：配置 HTTP 代理

1. **设置 → Wi-Fi**
2. **点击你连接的 Wi-Fi 网络**（右侧的 ⓘ 图标）
3. **向下滚动，找到"HTTP 代理"**
4. **选择"手动"**
5. **填写以下信息**：
   - **服务器**：`47.243.177.166`
     - 注意：不能有空格
     - 不能有 http:// 前缀
     - 就是纯 IP 地址
   - **端口**：`3128`
     - 注意：必须是数字，不是文字
   - **认证**：关闭（不填写用户名和密码）
6. **点击左上角"< Wi-Fi"返回**（配置会自动保存）

### 步骤3：重新连接 Wi-Fi（重要）

1. **设置 → Wi-Fi**
2. **关闭 Wi-Fi**（滑动开关）
3. **等待 10 秒**
4. **重新打开 Wi-Fi**
5. **重新连接你的 Wi-Fi 网络**
6. **确认代理配置还在**：
   - 点击网络 → HTTP 代理
   - 应该显示"手动"，服务器和端口已填写

### 步骤4：逐步测试

#### 测试1：基本连接

1. **打开 Safari 浏览器**
2. **访问**：`http://www.baidu.com`
3. **如果能打开**，说明代理基本工作 ✅
4. **如果打不开**，检查：
   - 安全组是否配置
   - 代理配置是否正确
   - Wi-Fi 是否已重新连接

#### 测试2：Google 访问

1. **访问**：`https://www.google.com`
2. **如果能看到 Google 首页**，说明完全成功 ✅
3. **如果提示"网页无效"**：
   - 尝试访问 `http://www.google.com`（非 HTTPS）
   - 或清除浏览器缓存后重试

---

## 🔍 实时监控代理连接

### 在远程桌面终端运行

```bash
# 实时查看代理访问日志
sudo tail -f /var/log/squid/access.log
```

然后在手机上访问任何网站，看日志中是否有新记录出现。

**如果有记录**：说明手机已连接到代理 ✅

**如果没有记录**：说明手机没有连接到代理 ❌
- 可能是安全组未配置
- 或代理配置错误

---

## 🐛 问题排查

### 问题1：所有网站都打不开

**原因**：代理配置后，所有流量都走代理，但代理无法连接

**解决**：
1. **立即关闭代理**（设置为"关闭"）
2. **重新连接 Wi-Fi**
3. **确认可以正常上网**
4. **检查安全组是否配置**
5. **重新配置代理**

### 问题2：能打开百度，但打不开 Google

**原因**：HTTPS 连接可能有问题

**解决**：
1. **清除浏览器缓存**
2. **尝试访问** `http://www.google.com`（非 HTTPS）
3. **或直接访问** `https://accounts.google.com`

### 问题3：代理日志中没有记录

**原因**：手机没有连接到代理

**可能原因**：
- 安全组未配置（最可能）
- 代理配置错误
- Wi-Fi 未重新连接

**解决**：
1. **确认安全组已配置 3128 端口**
2. **检查代理配置**（服务器和端口）
3. **重新连接 Wi-Fi**

---

## ✅ 配置检查清单

### 服务器端
- [x] Squid 服务运行正常
- [x] 端口 3128 已开放（UFW）
- [ ] **阿里云安全组已配置 3128 端口**（需要你确认）

### 手机端
- [ ] 使用 Wi-Fi（不是数据流量）
- [ ] HTTP 代理设置为"手动"
- [ ] 服务器：`47.243.177.166`（无空格）
- [ ] 端口：`3128`（数字）
- [ ] 认证：关闭
- [ ] 已重新连接 Wi-Fi

---

## 🚀 推荐操作顺序

1. **先配置阿里云安全组**（最重要！）
2. **在手机上配置代理**
3. **重新连接 Wi-Fi**
4. **先测试 baidu.com**（确认基本连接）
5. **再测试 Google**

---

## 📝 配置信息

- **服务器**：`47.243.177.166`
- **端口**：`3128`
- **类型**：HTTP 代理（手动）
- **认证**：关闭

---

**最后更新**：2025-11-26  
**关键**：必须先配置阿里云安全组！








