# 🔧 服务器防火墙和安全组配置

## 📋 问题

- ✅ 服务器本地测试正常（`curl localhost:8081` 返回视频）
- ❌ 从本地Mac无法访问（`curl http://47.243.177.166:8081` 失败）
- ❌ 应用无法连接服务器

**原因**：防火墙或安全组阻止了外部访问

## 🔧 在服务器终端执行

### 步骤1：检查防火墙

```bash
# 检查防火墙状态
sudo ufw status

# 如果防火墙阻止，开放端口
sudo ufw allow 8081/tcp
sudo ufw reload

# 或者检查 iptables
sudo iptables -L -n | grep 8081
```

### 步骤2：检查端口监听

```bash
# 检查8081端口是否监听在所有接口
netstat -tlnp | grep 8081

# 应该看到：0.0.0.0:8081 或 :::8081
# 如果只看到 127.0.0.1:8081，说明只监听本地，需要修改
```

### 步骤3：如果只监听本地，需要修改服务器代码

如果 `netstat` 显示只监听 `127.0.0.1:8081`，需要修改 `video_server.py`：

```python
# 应该监听所有接口
with ReusableTCPServer(("", PORT), VideoHandler) as httpd:
    # 而不是
    # with ReusableTCPServer(("127.0.0.1", PORT), VideoHandler) as httpd:
```

## 🌐 在阿里云控制台配置安全组

1. **登录阿里云控制台**：https://ecs.console.aliyun.com
2. **进入ECS实例管理**
3. **找到服务器**：`47.243.177.166`
4. **点击"安全组"**
5. **添加入站规则**：
   - **端口范围**：8081
   - **协议**：TCP
   - **授权对象**：0.0.0.0/0（允许所有IP访问）
   - **描述**：视频服务器端口

## ✅ 验证

配置完成后，在本地 Mac 测试：

```bash
# 测试服务器连接
curl http://47.243.177.166:8081/api/list/%E5%8E%9F%E5%88%9B%E8%A7%86%E9%A2%91
```

如果返回视频列表，说明配置成功！

## 📱 运行应用

服务器配置成功后，在本地 Mac 终端执行：

```bash
cd "/Volumes/Expansion/FlutterProjects/桌面影音播放器_安装包_20251121_165905"
flutter run -d Dianhua
```

应用应该可以连接服务器了。


