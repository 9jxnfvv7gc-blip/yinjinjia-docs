# 服务器连接问题排查指南

## 当前问题

应用无法连接到服务器 `47.243.177.166:8081`，错误信息：
- `No route to host` (errno = 65)
- 视频和音乐加载失败，返回 0 个

## 可能的原因

1. **服务器未运行**
   - 服务器可能已停止运行
   - 需要检查服务器状态

2. **网络连接问题**
   - iOS 设备可能无法访问该服务器 IP
   - 可能是网络防火墙或路由问题

3. **服务器防火墙**
   - 服务器可能只允许特定 IP 访问
   - 需要检查服务器防火墙规则

## 排查步骤

### 1. 检查服务器是否运行

在服务器上运行：
```bash
# SSH 连接到服务器
ssh root@47.243.177.166

# 检查服务器进程
ps aux | grep python
ps aux | grep video_server

# 检查端口是否监听
netstat -tlnp | grep 8081
# 或
lsof -i :8081
```

### 2. 检查服务器防火墙

在服务器上检查防火墙规则：
```bash
# 检查防火墙状态
ufw status
# 或
iptables -L -n

# 如果需要开放端口
ufw allow 8081/tcp
```

### 3. 测试服务器连接

在你的 Mac 上测试：
```bash
# 测试服务器是否可访问
curl http://47.243.177.166:8081/api/list/原创视频

# 如果成功，应该返回 JSON 数据
```

### 4. 检查服务器日志

在服务器上查看日志：
```bash
# 查看服务器日志（如果服务器正在运行）
# 根据你的服务器启动方式查看日志
```

## 解决方案

### 方案 1：重启服务器

如果服务器未运行，需要启动服务器：
```bash
# SSH 到服务器
ssh root@47.243.177.166

# 进入项目目录
cd /root/app  # 或你的项目目录

# 启动服务器
python3 video_server.py "/path/to/video/directory"
```

### 方案 2：检查网络连接

确保：
1. iOS 设备和服务器在同一网络或可以互相访问
2. 服务器防火墙允许 8081 端口访问
3. 路由器/防火墙没有阻止连接

### 方案 3：使用本地服务器测试

如果远程服务器无法访问，可以临时使用本地服务器测试：
1. 在 Mac 上启动本地服务器
2. 修改 `lib/config.dart` 中的 `productionApiUrl` 为本地地址
3. 确保 iOS 设备和 Mac 在同一 WiFi 网络

## 应用改进

我已经改进了应用的错误处理：
- ✅ 显示更友好的错误信息
- ✅ 提供重试按钮
- ✅ 显示连接状态
- ✅ 当连接失败时显示提示信息

## 下一步

1. **检查服务器状态**：确认服务器是否正在运行
2. **检查网络连接**：确认 iOS 设备能否访问服务器
3. **查看服务器日志**：了解服务器是否收到请求
4. **测试连接**：使用 curl 或其他工具测试服务器

如果服务器确实无法访问，我们可以：
- 使用本地服务器进行测试
- 配置服务器防火墙
- 或者暂时使用示例内容进行开发


